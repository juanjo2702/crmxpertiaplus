import{e as et,p as z,f as i,E as me,G as f,B as tt,H as st,c as a,a as te,b as t,d as c,u as se,h as ot,t as r,w as xe,l as be,q as H,k as y,v as j,F as x,r as T,n as k,I as oe,y as we,x as ae,J as at,s as lt,o as l,j as nt}from"./app-b6t0SSt8.js";import{_ as rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const it={class:"h-screen flex bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900"},dt={class:"hidden lg:flex w-16 flex-col bg-slate-900/80 border-r border-white/10"},ut={class:"h-16 flex items-center justify-center border-b border-white/10"},ct={class:"h-10 w-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center"},pt={class:"text-lg font-bold text-white"},vt={class:"flex-1 py-4 space-y-2"},ht={class:"p-3 border-t border-white/10"},ft={class:"text-sm font-bold text-white"},gt={key:0,class:"absolute bottom-16 left-2 w-48 rounded-lg bg-slate-800 border border-white/10 shadow-xl overflow-hidden z-50"},mt={class:"w-80 bg-slate-800/50 border-r border-white/10 flex flex-col backdrop-blur-xl"},xt={class:"p-4 border-b border-white/10"},bt={class:"flex items-center justify-between mb-3"},wt={class:"flex items-center gap-2"},yt={key:0,class:"bg-indigo-500 text-white px-2 py-0.5 rounded-full text-xs font-bold"},kt={class:"relative"},Ct={class:"flex-1 overflow-y-auto"},_t={key:0,class:"p-6 text-center text-slate-400"},Mt=["onClick"],Dt={class:"ml-3 flex-1 min-w-0"},jt={class:"flex justify-between items-center mb-1"},Tt={class:"font-semibold text-white truncate"},It={class:"text-xs text-slate-400 whitespace-nowrap ml-2"},Lt={class:"text-sm text-slate-400 truncate"},Bt={key:0,class:"ml-2 bg-indigo-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center"},Ut={key:0,class:"flex-1 flex flex-col min-h-0"},Rt={class:"px-5 py-3 bg-slate-800/80 border-b border-white/10 flex items-center justify-between shrink-0 backdrop-blur-xl"},Et={class:"flex items-center"},$t={class:"ml-3"},zt={class:"font-semibold text-white"},Vt={key:0,class:"flex justify-center my-4"},Ft={class:"bg-slate-700/80 text-slate-300 text-xs font-medium px-4 py-1.5 rounded-full"},Nt=["src","onClick"],Ot={key:0,class:"text-sm text-white mt-2"},At={class:"flex items-start gap-3 min-w-[220px] p-2 bg-slate-600/50 rounded-lg"},Pt={class:"text-white text-xs font-bold"},St={class:"flex-1 min-w-0"},Ht={class:"text-sm font-medium text-white truncate"},Wt={class:"text-xs text-slate-300 mt-0.5"},Kt={class:"flex gap-4 mt-2 text-sm"},Zt=["onClick"],qt=["href","download"],Gt={key:2,class:"flex items-center gap-3 min-w-[200px] p-2"},Jt={controls:"",class:"w-full max-w-[240px] h-8",controllerslist:"nodownload"},Yt=["src"],Qt=["src"],Xt=["src"],es={key:3,class:"text-sm text-white break-words"},ts={class:"flex items-center justify-end gap-1 mt-1"},ss={class:"text-[10px] text-white/60"},os={key:0,class:"w-4 h-4 text-white/60",fill:"currentColor",viewBox:"0 0 24 24"},as={key:0,class:"absolute inset-0 bg-indigo-500/20 border-4 border-dashed border-indigo-500 rounded-lg flex items-center justify-center z-50"},ls={class:"px-4 py-3 bg-slate-800/80 border-t border-white/10 flex items-center gap-3 backdrop-blur-xl"},ns={key:1,class:"flex-1 px-5 py-3 rounded-xl bg-slate-700/50 border border-white/10 flex items-center justify-between"},rs={class:"flex items-center gap-3"},is={class:"text-white font-mono text-sm"},ds=["disabled"],us={key:3,class:"flex gap-2"},cs={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ps={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vs={key:1,class:"flex-1 flex flex-col items-center justify-center text-slate-400"},hs={key:0,class:"hidden xl:flex w-80 bg-slate-900 border-l border-white/10 flex-col backdrop-blur-xl shrink-0 transition-all"},fs={key:0,class:"flex-1 flex items-center justify-center text-slate-400"},gs={key:1,class:"flex-1 overflow-y-auto p-4 space-y-6"},ms={class:"p-3 bg-slate-800/50 rounded-lg border border-white/5"},xs={class:"text-white font-medium"},bs={class:"text-slate-400 text-sm"},ws={class:"text-slate-400 text-sm"},ys={class:"space-y-4"},ks={class:"space-y-2 max-h-40 overflow-y-auto pr-1"},Cs=["checked","onChange"],_s={class:"text-white block"},Ms={key:0,class:"text-xs text-slate-500"},Ds={key:0,class:"text-xs text-slate-500 italic"},js={class:"space-y-2"},Ts=["checked","onChange"],Is={class:"text-white"},Ls={key:0,class:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4"},Bs={class:"bg-slate-900 border border-white/10 rounded-xl max-w-lg w-full max-h-[90vh] flex flex-col overflow-hidden shadow-2xl"},Us={class:"flex items-center justify-between p-4 border-b border-white/10"},Rs={class:"flex items-center gap-3"},Es={class:"text-white font-medium"},$s={class:"flex-1 overflow-y-auto p-4 bg-slate-800/50"},zs={key:0,class:"flex items-center justify-center min-h-[200px]"},Vs=["src"],Fs={key:1,class:"text-center"},Ns={class:"text-white font-medium"},Os={class:"text-slate-400 text-sm"},As={key:1,class:"flex gap-2 mt-4 justify-center flex-wrap"},Ps=["onClick"],Ss=["src"],Hs={key:1,class:"w-16 h-16 bg-slate-700 flex items-center justify-center"},Ws=["onClick"],Ks={class:"p-4 bg-slate-800 border-t border-white/10"},Zs={class:"flex items-center gap-3"},qs=["disabled"],Gs={key:1,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"},Js={class:"bg-slate-900 border border-white/10 rounded-xl max-w-sm w-full shadow-2xl overflow-hidden"},Ys={class:"p-4 bg-indigo-600 flex justify-between items-center"},Qs={class:"p-6 space-y-4"},Xs={class:"relative"},eo=["value"],to=["disabled"],so={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},oo={__name:"Index",props:{initialContacts:Array,catalogs:{type:Object,default:()=>({})}},setup(V){const ye=V,le=et(),ke=z(()=>le.props.auth.user),Ce=z(()=>le.props.auth?.user?.tenant||{});i(!1);const I=i(!1),_e=()=>{lt.post(route("logout"))},g=i(ye.initialContacts),d=i(null),b=i([]),F=i(null),N=i(""),Me=i(null),De=i(null),O=i(!1),je=i(!0),W=i(!1),v=i({nivel_interes:"",estado_crm:"",notas_crm:"",sedes:[],carreras:[],ofertas:[],eventos:[]}),Te=async o=>{W.value=!0;try{const e=await f.get(route("chat.contact.details",o));v.value=e.data}catch(e){console.error("Error fetching CRM data",e)}finally{W.value=!1}},Ie=async()=>{if(d.value)try{await f.put(route("chat.contact.update",d.value.id),v.value)}catch(o){console.error("Failed to update CRM",o),alert("Error al guardar datos CRM")}},ne=(o,e)=>{const s=v.value[o],n=s.indexOf(e);n>-1?s.splice(n,1):s.push(e)},L=i(!1),K=i("591"),C=i(""),A=i(""),B=i([]),U=i(!1);me(L,o=>{o&&B.value.length===0&&Le()});const Le=async()=>{try{const o=await f.get("/debug-templates");o.data&&o.data.data&&(B.value=o.data.data.filter(e=>e.status==="APPROVED").map(e=>({name:e.name,language:e.language})),B.value.length>0&&(A.value=B.value[0].name))}catch(o){console.error("Error fetching templates",o)}},re=z(()=>g.value.reduce((o,e)=>o+(e.unread||0),0)),ie=async()=>{if(C.value){U.value=!0;try{const o=K.value+C.value,s=(await f.post(route("chat.initiate"),{phone:o,template:A.value})).data,n=g.value.findIndex(h=>h.id===s.id);n===-1?(g.value.unshift({...s,relativeDate:G(s.time,!0),formattedTime:$(s.time)}),J(g.value[0])):J(g.value[n]),L.value=!1,C.value=""}catch(o){console.error("Error initiating chat",o),alert("Error al iniciar chat")}finally{U.value=!1}}},P=i(!1),u=i([]),_=i(""),m=i(0),w=i(!1),R=i(0),p=i(null),E=i([]),Z=i(null);let q=null;const Be=["Domingo","Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado"],Ue=["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],$=o=>{if(!o)return"";let e;return o.includes("T")&&(o.includes("+")||o.includes("Z"))?e=new Date(o):e=new Date(o.replace(" ","T")+"Z"),isNaN(e.getTime())?o:e.toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"})},G=(o,e=!1)=>{if(!o)return"";let s;if(o.includes("T")&&(o.includes("+")||o.includes("Z"))?s=new Date(o):s=new Date(o.replace(" ","T")+"Z"),isNaN(s.getTime()))return o;const n=new Date,h=new Date(n.getFullYear(),n.getMonth(),n.getDate()),ee=new Date(s.getFullYear(),s.getMonth(),s.getDate()),S=Math.floor((h-ee)/(1e3*60*60*24));return S===0?e?$(o):"Hoy":S===1?"Ayer":S===2?"Anteayer":S<7?Be[s.getDay()]:`${s.getDate()} ${Ue[s.getMonth()]}`},Re=o=>{if(!o)return"";let e;return o.includes("T")&&(o.includes("+")||o.includes("Z"))?e=new Date(o):e=new Date(o.replace(" ","T")+"Z"),`${e.getFullYear()}-${e.getMonth()}-${e.getDate()}`},de=z(()=>{if(!N.value.trim())return g.value;const o=N.value.toLowerCase();return g.value.filter(e=>e.name&&e.name.toLowerCase().includes(o)||e.lastMessage&&e.lastMessage.toLowerCase().includes(o))}),Ee=z(()=>{const o=[];let e=null;return b.value.forEach(s=>{const n=Re(s.rawDate);n!==e&&(o.push({type:"separator",date:G(s.rawDate),key:"sep-"+n}),e=n),o.push({type:"message",...s})}),o}),$e=async()=>{await at(),setTimeout(()=>{F.value&&(F.value.scrollTop=F.value.scrollHeight)},100)};me(b,()=>{$e()},{deep:!0});const J=async o=>{if(d.value=o,b.value=[],ue(),Te(o.id),o.unread>0)try{await f.post(route("chat.read",o.id));const e=g.value.findIndex(s=>s.id===o.id);e!==-1&&(g.value[e].unread=0)}catch(e){console.error("Error marking as read",e)}},ue=async()=>{if(d.value)try{const e=(await f.get(route("chat.messages",d.value.id))).data.map(s=>({id:s.id,text:s.body,sender:s.direction==="outgoing"?"me":"them",time:$(s.created_at),rawDate:s.created_at,msgType:s.type,metadata:(()=>{if(!s.metadata)return null;if(typeof s.metadata=="object")return s.metadata;try{return JSON.parse(s.metadata)}catch(n){return console.error("Error parsing metadata",n,s.metadata),null}})()}));e.length!==b.value.length&&(b.value=e)}catch(o){console.error("Error loading messages",o)}},ze=async()=>{try{const o=await f.get(route("chat.contacts"));g.value=o.data.map(e=>({...e,relativeDate:G(e.time,!0),formattedTime:$(e.time)}))}catch(o){console.error("Error fetching contacts",o)}},M=i(""),D=i(!1),ce=async()=>{if(!M.value.trim()||!d.value)return;const o=M.value;M.value="",D.value=!0;const e=new Date().toISOString(),s=Date.now();b.value.push({id:s,text:o,sender:"me",time:$(e),rawDate:e});try{await f.post(route("chat.send",d.value.id),{message:o})}catch(n){console.error("Failed to send",n),alert("Error al enviar mensaje")}finally{D.value=!1}},pe=o=>{if(!o)return"?";const e=o.split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():o.substring(0,2).toUpperCase()},ve=o=>{if(!o)return"bg-slate-500";const e=["bg-indigo-500","bg-purple-500","bg-pink-500","bg-rose-500","bg-orange-500","bg-teal-500","bg-cyan-500","bg-emerald-500"],s=o.charCodeAt(0)%e.length;return e[s]},Ve=o=>{window.open(o,"_blank")},Y=o=>{if(o.metadata?.filename)return o.metadata.filename;if(o.text&&!o.text.includes("/"))return o.text;if(o.text?.includes("/")){const e=o.text.split("/");return e[e.length-1]||"Documento"}return"Documento"},Q=o=>Y(o).split(".").pop()?.toUpperCase()||"Archivo",he=o=>o.metadata?.local_url?o.metadata.local_url:o.text?.startsWith("http")?o.text:`/storage/chat-media/${o.text}`,Fe=o=>{const e=Q(o).toLowerCase();return{pdf:"bg-red-500",doc:"bg-blue-600",docx:"bg-blue-600",xls:"bg-green-600",xlsx:"bg-green-600",txt:"bg-gray-500"}[e]||"bg-slate-500"},Ne=o=>{const e=Q(o).toUpperCase();return e.length>4?e.substring(0,4):e},Oe=o=>{const e=he(o);window.open(e,"_blank")},Ae=async(o,e="")=>{const s=new FormData;s.append("image",o),e&&s.append("caption",e);const n=Date.now()+Math.random(),h=URL.createObjectURL(o);b.value.push({id:n,text:h,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"image",metadata:e?{caption:e}:null});try{await f.post(route("chat.sendImage",d.value.id),s,{headers:{"Content-Type":"multipart/form-data"}})}catch(ee){console.error("Failed to send image",ee)}},Pe=async o=>{const e=new FormData;e.append("document",o),e.append("filename",o.name);const s=Date.now()+Math.random();b.value.push({id:s,text:o.name,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"document"});try{await f.post(route("chat.sendDocument",d.value.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(n){console.error("Failed to send document",n)}},Se=async()=>{try{const o=await navigator.mediaDevices.getUserMedia({audio:!0});let e={};MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?e={mimeType:"audio/webm;codecs=opus"}:MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")?e={mimeType:"audio/ogg;codecs=opus"}:MediaRecorder.isTypeSupported("audio/mp4")?e={mimeType:"audio/mp4"}:console.warn("Using default MediaRecorder mimeType"),p.value=new MediaRecorder(o,e),E.value=[],p.value.ondataavailable=s=>{E.value.push(s.data)},p.value.onstop=()=>{o.getTracks().forEach(s=>s.stop())},p.value.start(200),w.value=!0,R.value=0,Z.value=setInterval(()=>{R.value++},1e3)}catch(o){console.error("Error accessing microphone",o),alert("No se pudo acceder al micrÃ³fono")}},He=()=>{p.value&&(p.value.onstop=async()=>{const o=p.value.mimeType,e=o.includes("mp4")?"mp4":"ogg",s=o.includes("mp4")?"audio/mp4":"audio/ogg",n=new Blob(E.value,{type:o}),h=new File([n],`voice_note.${e}`,{type:s});await Ze(h),w.value=!1,clearInterval(Z.value),R.value=0,E.value=[]},p.value.stop())},We=()=>{p.value&&w.value&&(p.value.stop(),w.value=!1,clearInterval(Z.value),R.value=0,E.value=[],p.value.stream&&p.value.stream.getTracks().forEach(o=>o.stop()))},Ke=o=>{const e=Math.floor(o/60),s=o%60;return`${e}:${s.toString().padStart(2,"0")}`},Ze=async o=>{const e=new FormData;e.append("audio",o);const s=Date.now()+Math.random(),n=URL.createObjectURL(o);b.value.push({id:s,text:n,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"audio"});try{await f.post(route("chat.sendAudio",d.value.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(h){console.error("Failed to send audio",h),alert("Error al enviar audio")}},qe=o=>{const e=Array.from(o.target.files);!e.length||!d.value||(X(e),o.target.value="")},Ge=o=>{const e=Array.from(o.target.files);!e.length||!d.value||(X(e),o.target.value="")},X=o=>{u.value=o.map(e=>({file:e,name:e.name,type:e.type,isImage:e.type.startsWith("image/"),preview:e.type.startsWith("image/")?URL.createObjectURL(e):null,size:(e.size/1024).toFixed(1)+" KB"})),m.value=0,_.value="",P.value=!0},fe=()=>{u.value.forEach(o=>{o.preview&&URL.revokeObjectURL(o.preview)}),u.value=[],_.value="",P.value=!1},Je=o=>{u.value[o].preview&&URL.revokeObjectURL(u.value[o].preview),u.value.splice(o,1),u.value.length===0?fe():m.value>=u.value.length&&(m.value=u.value.length-1)},ge=async()=>{if(!u.value.length||!d.value)return;P.value=!1,D.value=!0;const o=_.value;for(const e of u.value)e.isImage?await Ae(e.file,o):await Pe(e.file);u.value.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)}),u.value=[],_.value="",D.value=!1},Ye=o=>{o.preventDefault(),O.value=!0},Qe=()=>{O.value=!1},Xe=o=>{if(o.preventDefault(),O.value=!1,!d.value)return;const e=Array.from(o.dataTransfer.files);e.length&&X(e)};return tt(()=>{q=setInterval(()=>{ze(),d.value&&ue()},5e3)}),st(()=>{q&&clearInterval(q)}),(o,e)=>(l(),a(x,null,[te(se(ot),{title:"Chat WhatsApp"}),t("div",it,[t("div",dt,[t("div",ut,[t("div",ct,[t("span",pt,r(Ce.value?.name?.charAt(0)||"C"),1)])]),t("nav",vt,[te(se(be),{href:o.route("tenant.dashboard"),class:"flex items-center justify-center p-3 mx-2 rounded-xl text-slate-400 hover:bg-white/10 hover:text-white transition-colors",title:"Dashboard"},{default:xe(()=>[...e[16]||(e[16]=[t("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)])]),_:1},8,["href"]),e[17]||(e[17]=t("div",{class:"flex items-center justify-center p-3 mx-2 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg"},[t("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1))]),t("div",ht,[t("button",{onClick:e[0]||(e[0]=s=>I.value=!I.value),class:"relative w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center mx-auto"},[t("span",ft,r(ke.value?.name?.charAt(0)||"U"),1)]),I.value?(l(),a("div",gt,[te(se(be),{href:o.route("tenant.settings"),class:"flex items-center gap-2 px-4 py-2.5 text-sm text-slate-300 hover:bg-white/10"},{default:xe(()=>[...e[18]||(e[18]=[H(" ConfiguraciÃ³n",-1)])]),_:1},8,["href"]),t("button",{onClick:_e,class:"flex w-full items-center gap-2 px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10"},"Cerrar SesiÃ³n")])):c("",!0)])]),t("div",mt,[t("div",xt,[t("div",bt,[t("div",wt,[e[19]||(e[19]=t("h2",{class:"text-white font-semibold text-lg"},"Conversaciones",-1)),re.value>0?(l(),a("span",yt,r(re.value),1)):c("",!0)]),t("button",{onClick:e[1]||(e[1]=s=>L.value=!0),class:"p-2 bg-indigo-500/20 hover:bg-indigo-500/30 rounded-lg text-indigo-400 transition-colors",title:"Nuevo Chat"},[...e[20]||(e[20]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])]),t("div",kt,[e[21]||(e[21]=t("svg",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),y(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>N.value=s),type:"text",placeholder:"Buscar chat...",class:"w-full pl-10 pr-4 py-2.5 rounded-xl bg-slate-700/50 border border-white/10 text-white text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},null,512),[[j,N.value]])])]),t("div",Ct,[de.value.length===0?(l(),a("div",_t,[...e[22]||(e[22]=[t("svg",{class:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),t("p",{class:"text-sm"},"No hay conversaciones",-1)])])):c("",!0),(l(!0),a(x,null,T(de.value,s=>(l(),a("div",{key:s.id,onClick:n=>J(s),class:k(["flex items-center p-4 cursor-pointer border-b border-white/5 transition-all duration-200 hover:bg-white/5",{"bg-indigo-500/20 border-l-4 border-l-indigo-500":d.value&&d.value.id===s.id}])},[t("div",{class:k([ve(s.name),"w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-sm shadow-md"])},r(pe(s.name)),3),t("div",Dt,[t("div",jt,[t("h3",Tt,r(s.name),1),t("span",It,r(s.relativeDate||s.formattedTime),1)]),t("p",Lt,r(s.lastMessage||"Sin mensajes"),1)]),s.unread>0?(l(),a("div",Bt,r(s.unread),1)):c("",!0)],10,Mt))),128))])]),t("div",{class:"flex-1 flex flex-col bg-slate-900/50 min-h-0 relative",onDragover:Ye,onDragleave:Qe,onDrop:Xe},[d.value?(l(),a("div",Ut,[t("div",Rt,[t("div",Et,[t("div",{class:k([ve(d.value.name),"w-11 h-11 rounded-full flex items-center justify-center text-white font-semibold shadow-md"])},r(pe(d.value.name)),3),t("div",$t,[t("h3",zt,r(d.value.name),1),e[23]||(e[23]=t("p",{class:"text-xs text-green-400"},"En lÃ­nea",-1))])])]),t("div",{ref_key:"messageContainer",ref:F,class:"flex-1 overflow-y-auto px-6 py-4 min-h-0"},[(l(!0),a(x,null,T(Ee.value,s=>(l(),a(x,{key:s.key||s.id},[s.type==="separator"?(l(),a("div",Vt,[t("span",Ft,r(s.date),1)])):(l(),a("div",{key:1,class:k(["flex mb-2",s.sender==="me"?"justify-end":"justify-start"])},[t("div",{class:k(["max-w-[70%] px-3 py-2 rounded-xl shadow-sm relative",s.sender==="me"?"bg-indigo-600 rounded-br-sm":"bg-slate-700 rounded-bl-sm"])},[s.msgType==="image"?(l(),a(x,{key:0},[t("img",{src:s.text,alt:"Imagen",class:"max-w-[280px] max-h-[300px] rounded-lg cursor-pointer hover:opacity-90 object-cover",onClick:n=>Ve(s.text)},null,8,Nt),s.metadata?.caption?(l(),a("p",Ot,r(s.metadata.caption),1)):c("",!0)],64)):s.msgType==="document"?(l(),a(x,{key:1},[t("div",At,[t("div",{class:k(["flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center",Fe(s)])},[t("span",Pt,r(Ne(s)),1)],2),t("div",St,[t("p",Ht,r(Y(s)),1),t("p",Wt,r(Q(s)),1)])]),t("div",Kt,[t("button",{onClick:n=>Oe(s),class:"text-indigo-300 hover:text-indigo-200 font-medium"},"Abrir",8,Zt),t("a",{href:he(s),download:Y(s),class:"text-indigo-300 hover:text-indigo-200 font-medium"},"Descargar",8,qt)])],64)):s.msgType==="audio"?(l(),a("div",Gt,[t("audio",Jt,[t("source",{src:s.text.startsWith("http")||s.text.startsWith("blob:")?s.text:`/storage/${s.text.replace("public/","")}`,type:"audio/mpeg"},null,8,Yt),t("source",{src:s.text.startsWith("http")||s.text.startsWith("blob:")?s.text:`/storage/${s.text.replace("public/","")}`,type:"audio/ogg"},null,8,Qt),t("source",{src:s.text.startsWith("http")||s.text.startsWith("blob:")?s.text:`/storage/${s.text.replace("public/","")}`,type:"audio/webm"},null,8,Xt),e[24]||(e[24]=H(" Tu navegador no soporta audio. ",-1))])])):(l(),a("p",es,r(s.text),1)),t("div",ts,[t("span",ss,r(s.time),1),s.sender==="me"?(l(),a("svg",os,[...e[25]||(e[25]=[t("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"},null,-1)])])):c("",!0)])],2)],2))],64))),128))],512),O.value?(l(),a("div",as,[...e[26]||(e[26]=[t("div",{class:"text-center"},[t("svg",{class:"w-16 h-16 mx-auto text-indigo-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),t("p",{class:"text-lg font-semibold text-indigo-300"},"Suelta tus archivos aquÃ­")],-1)])])):c("",!0),t("div",ls,[t("input",{type:"file",ref_key:"imageInput",ref:Me,accept:"image/*",multiple:"",class:"hidden",onChange:qe},null,544),t("input",{type:"file",ref_key:"documentInput",ref:De,multiple:"",class:"hidden",onChange:Ge},null,544),t("button",{onClick:e[3]||(e[3]=s=>o.$refs.imageInput.click()),class:"p-2 rounded-lg hover:bg-white/10 text-slate-400 transition-colors",title:"Enviar imagen"},[...e[27]||(e[27]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]),t("button",{onClick:e[4]||(e[4]=s=>o.$refs.documentInput.click()),class:"p-2 rounded-lg hover:bg-white/10 text-slate-400 transition-colors",title:"Enviar documento"},[...e[28]||(e[28]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])]),w.value?(l(),a("div",ns,[t("div",rs,[e[29]||(e[29]=t("span",{class:"relative flex h-3 w-3"},[t("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),t("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})],-1)),t("span",is,r(Ke(R.value)),1)]),e[30]||(e[30]=t("span",{class:"text-slate-400 text-xs"},"Grabando audio...",-1))])):y((l(),a("input",{key:0,"onUpdate:modelValue":e[5]||(e[5]=s=>M.value=s),onKeyup:oe(ce,["enter"]),type:"text",placeholder:"Escribe un mensaje",class:"flex-1 px-5 py-3 rounded-xl bg-slate-700/50 border border-white/10 text-white text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,544)),[[j,M.value]]),M.value.trim()?(l(),a("button",{key:2,onClick:ce,disabled:D.value,class:"p-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-lg"},[...e[31]||(e[31]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,ds)):(l(),a("div",us,[w.value?(l(),a("button",{key:0,onClick:We,class:"p-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors shadow-lg",title:"Cancelar"},[...e[32]||(e[32]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):c("",!0),t("button",{onClick:e[6]||(e[6]=s=>w.value?He():Se()),class:k(["p-3 text-white rounded-xl transition-colors shadow-lg",w.value?"bg-green-500 hover:bg-green-600":"bg-slate-700 hover:bg-slate-600"])},[w.value?(l(),a("svg",ps,[...e[34]||(e[34]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(l(),a("svg",cs,[...e[33]||(e[33]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},null,-1)])]))],2)]))])])):(l(),a("div",vs,[...e[35]||(e[35]=[we('<div class="w-24 h-24 bg-slate-700/50 rounded-full flex items-center justify-center mb-4" data-v-21214ba4><svg class="w-12 h-12 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-21214ba4><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-21214ba4></path></svg></div><h3 class="text-xl font-medium text-white mb-2" data-v-21214ba4>Chat WhatsApp</h3><p class="text-sm" data-v-21214ba4>Selecciona un chat para comenzar</p>',3)])]))],32),d.value&&je.value?(l(),a("div",hs,[t("div",{class:"p-4 border-b border-white/10 flex justify-between items-center"},[e[36]||(e[36]=t("h3",{class:"text-white font-semibold"},"CRM Contacto",-1)),t("button",{onClick:Ie,class:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium rounded-lg transition-colors"}," Guardar ")]),W.value?(l(),a("div",fs,[...e[37]||(e[37]=[t("svg",{class:"animate-spin h-5 w-5 mr-2 text-white",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),H(" Cargando... ",-1)])])):(l(),a("div",gs,[t("div",ms,[e[38]||(e[38]=t("p",{class:"text-xs text-slate-500 uppercase font-bold mb-2"},"Contacto",-1)),t("p",xs,r(d.value.name),1),t("p",bs,r(d.value.wa_id),1),t("p",ws,r(d.value.email||"Sin email"),1)]),t("div",ys,[t("div",null,[e[40]||(e[40]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Nivel de InterÃ©s",-1)),y(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>v.value.nivel_interes=s),class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none"},[...e[39]||(e[39]=[t("option",{value:""},"-- Seleccionar --",-1),t("option",{value:"frio"},"â„ï¸ FrÃ­o",-1),t("option",{value:"tibio"},"ðŸ”¥ Tibio",-1),t("option",{value:"caliente"},"ðŸ’¥ Caliente",-1)])],512),[[ae,v.value.nivel_interes]])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Estado CRM",-1)),y(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>v.value.estado_crm=s),class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none"},[...e[41]||(e[41]=[we('<option value="" data-v-21214ba4>-- Seleccionar --</option><option value="prospecto" data-v-21214ba4>Prospecto</option><option value="interesado" data-v-21214ba4>Interesado</option><option value="inscrito" data-v-21214ba4>Inscrito</option><option value="perdido" data-v-21214ba4>Perdido</option>',5)])],512),[[ae,v.value.estado_crm]])])]),t("div",null,[e[43]||(e[43]=t("label",{class:"block text-xs font-medium text-slate-400 mb-2"},"Carreras de InterÃ©s",-1)),t("div",ks,[(l(!0),a(x,null,T(V.catalogs.carreras,s=>(l(),a("label",{key:s.id,class:"flex items-start gap-2 p-2 rounded hover:bg-white/5 cursor-pointer text-sm"},[t("input",{type:"checkbox",checked:v.value.carreras.includes(s.id),onChange:n=>ne("carreras",s.id),class:"mt-1 rounded bg-slate-700 border-slate-500 text-indigo-600 focus:ring-indigo-500"},null,40,Cs),t("div",null,[t("span",_s,r(s.nombre),1),s.duracion?(l(),a("span",Ms,r(s.duracion),1)):c("",!0)])]))),128)),V.catalogs.carreras?.length?c("",!0):(l(),a("p",Ds,"No hay carreras disponibles"))])]),t("div",null,[e[44]||(e[44]=t("label",{class:"block text-xs font-medium text-slate-400 mb-2"},"Sedes Preferidas",-1)),t("div",js,[(l(!0),a(x,null,T(V.catalogs.sedes,s=>(l(),a("label",{key:s.id,class:"flex items-center gap-2 p-2 rounded hover:bg-white/5 cursor-pointer text-sm"},[t("input",{type:"checkbox",checked:v.value.sedes.includes(s.id),onChange:n=>ne("sedes",s.id),class:"rounded bg-slate-700 border-slate-500 text-indigo-600 focus:ring-indigo-500"},null,40,Ts),t("span",Is,r(s.nombre),1)]))),128))])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Notas / Observaciones",-1)),y(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>v.value.notas_crm=s),rows:"4",class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none placeholder-slate-600",placeholder:"Escribe notas aquÃ­..."},null,512),[[j,v.value.notas_crm]])]),e[46]||(e[46]=t("div",{class:"h-10"},null,-1))]))])):c("",!0),I.value?(l(),a("div",{key:1,onClick:e[10]||(e[10]=s=>I.value=!1),class:"fixed inset-0 z-40"})):c("",!0)]),P.value?(l(),a("div",Ls,[t("div",Bs,[t("div",Us,[t("div",Rs,[t("button",{onClick:fe,class:"p-2 hover:bg-white/10 rounded-full transition-colors"},[...e[47]||(e[47]=[t("svg",{class:"w-5 h-5 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),t("span",Es,r(u.value.length)+" archivo"+r(u.value.length>1?"s":""),1)])]),t("div",$s,[u.value[m.value]?(l(),a("div",zs,[u.value[m.value].isImage?(l(),a("img",{key:0,src:u.value[m.value].preview,class:"max-w-full max-h-[300px] rounded-lg object-contain"},null,8,Vs)):(l(),a("div",Fs,[e[48]||(e[48]=t("svg",{class:"w-20 h-20 mx-auto text-slate-500 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t("p",Ns,r(u.value[m.value].name),1),t("p",Os,r(u.value[m.value].size),1)]))])):c("",!0),u.value.length>1?(l(),a("div",As,[(l(!0),a(x,null,T(u.value,(s,n)=>(l(),a("div",{key:n,class:k(["relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all",m.value===n?"border-indigo-500":"border-transparent"]),onClick:h=>m.value=n},[s.isImage?(l(),a("img",{key:0,src:s.preview,class:"w-16 h-16 object-cover"},null,8,Ss)):(l(),a("div",Hs,[...e[49]||(e[49]=[t("svg",{class:"w-8 h-8 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])])),t("button",{onClick:nt(h=>Je(n),["stop"]),class:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center shadow-lg"},[...e[50]||(e[50]=[t("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ws)],10,Ps))),128))])):c("",!0)]),t("div",Ks,[t("div",Zs,[y(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>_.value=s),type:"text",placeholder:"Agregar un comentario...",class:"flex-1 bg-slate-700/50 text-white px-4 py-3 rounded-xl border border-white/10 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 placeholder-slate-400",onKeyup:oe(ge,["enter"])},null,544),[[j,_.value]]),t("button",{onClick:ge,disabled:D.value,class:"p-3 bg-indigo-500 hover:bg-indigo-600 rounded-xl transition-colors disabled:opacity-50"},[...e[51]||(e[51]=[t("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,qs)])])])])):c("",!0),L.value?(l(),a("div",Gs,[t("div",Js,[t("div",Ys,[e[53]||(e[53]=t("h3",{class:"text-white font-semibold text-lg"},"Iniciar ConversaciÃ³n",-1)),t("button",{onClick:e[12]||(e[12]=s=>L.value=!1),class:"text-white/80 hover:text-white transition-colors"},[...e[52]||(e[52]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Qs,[t("div",null,[e[55]||(e[55]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Prefijo PaÃ­s",-1)),t("div",Xs,[e[54]||(e[54]=t("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium"},"+",-1)),y(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>K.value=s),type:"text",class:"w-full pl-6 pr-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none",placeholder:"591"},null,512),[[j,K.value]])])]),t("div",null,[e[56]||(e[56]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"NÃºmero de TelÃ©fono",-1)),y(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>C.value=s),type:"tel",class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none",placeholder:"70012345",onKeyup:oe(ie,["enter"])},null,544),[[j,C.value]])]),t("div",null,[e[58]||(e[58]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Plantilla de Inicio (Opcional)",-1)),y(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>A.value=s),class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none text-sm"},[e[57]||(e[57]=t("option",{value:""},"-- Ninguna --",-1)),(l(!0),a(x,null,T(B.value,s=>(l(),a("option",{key:s.name,value:s.name},r(s.name)+" ("+r(s.language)+") ",9,eo))),128))],512),[[ae,A.value]]),e[59]||(e[59]=t("p",{class:"text-xs text-slate-400 mt-1"},"Si el contacto no te ha escrito en 24h, usa una plantilla. ",-1))]),t("button",{onClick:ie,disabled:U.value||!C.value,class:"w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[U.value?(l(),a("span",so)):c("",!0),H(" "+r(U.value?"Iniciando...":"Iniciar Chat"),1)],8,to)])])])):c("",!0)],64))}},no=rt(oo,[["__scopeId","data-v-21214ba4"]]);export{no as default};

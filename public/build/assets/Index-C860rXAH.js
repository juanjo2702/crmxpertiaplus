import{e as It,p as V,f as n,E as ae,G as v,H as be,B as Lt,I as Bt,c as l,a as we,b as t,d as u,u as ye,h as $t,t as r,w as Ae,l as Ne,q as W,k as w,v as $,n as y,F as g,r as j,J as Ut,y as Se,x as ne,K as Pe,s as Et,o as a,j as zt}from"./app-BELvaZ_X.js";import{_ as Rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ft={class:"h-screen flex bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900"},Vt={class:"hidden lg:flex w-16 flex-col bg-slate-900/80 border-r border-white/10"},At={class:"h-16 flex items-center justify-center border-b border-white/10"},Nt={class:"h-10 w-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center"},St={class:"text-lg font-bold text-white"},Pt={class:"flex-1 py-4 space-y-2"},Ot={class:"p-3 border-t border-white/10"},Ht={class:"text-sm font-bold text-white"},Kt={key:0,class:"absolute bottom-16 left-2 w-48 rounded-lg bg-slate-800 border border-white/10 shadow-xl overflow-hidden z-50"},Wt={class:"w-80 bg-slate-800/50 border-r border-white/10 flex flex-col backdrop-blur-xl"},Zt={class:"p-4 border-b border-white/10"},Gt={class:"flex items-center justify-between mb-3"},qt={class:"flex items-center gap-2"},Jt={key:0,class:"bg-indigo-500 text-white px-2 py-0.5 rounded-full text-xs font-bold"},Yt={class:"relative"},Qt={class:"px-4 py-2 border-b border-white/10 flex items-center gap-2 flex-wrap"},Xt=["value"],es={class:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center"},ts={class:"flex-1 overflow-y-auto"},ss={key:0,class:"p-6 text-center text-slate-400"},os=["onClick"],ls={class:"ml-3 flex-1 min-w-0"},as={class:"flex justify-between items-center mb-1"},ns={class:"font-semibold text-white truncate"},rs={class:"text-xs text-slate-400 whitespace-nowrap ml-2"},is={class:"text-sm text-slate-400 truncate"},ds={key:0,class:"ml-2 bg-indigo-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center"},us={key:0,class:"flex-1 flex flex-col min-h-0"},cs={class:"px-5 py-3 bg-slate-800/80 border-b border-white/10 flex items-center justify-between shrink-0 backdrop-blur-xl"},ps={class:"flex items-center"},vs={class:"ml-3"},gs={class:"font-semibold text-white"},fs={key:0,class:"text-xs text-amber-400"},ms={key:1,class:"text-xs text-green-400"},hs={key:0,class:"flex justify-center my-4"},xs={class:"bg-slate-700/80 text-slate-300 text-xs font-medium px-4 py-1.5 rounded-full"},bs=["src","onClick"],ws={key:0,class:"text-sm text-white mt-2"},ys={class:"flex items-start gap-3 min-w-[220px] p-2 bg-slate-600/50 rounded-lg"},ks={class:"text-white text-xs font-bold"},Cs={class:"flex-1 min-w-0"},_s={class:"text-sm font-medium text-white truncate"},Ms={class:"text-xs text-slate-300 mt-0.5"},js={class:"flex gap-4 mt-2 text-sm"},Ds=["onClick"],Ts=["href","download"],Is={key:2,class:"flex items-center gap-3 min-w-[200px] p-2"},Ls={controls:"",class:"w-full max-w-[240px] h-8",controllerslist:"nodownload"},Bs=["src"],$s=["src"],Us=["src"],Es=["innerHTML"],zs={class:"flex items-center justify-end gap-1 mt-1"},Rs={class:"text-[10px] text-white/60"},Fs={key:0,class:"w-4 h-4 text-white/60",fill:"currentColor",viewBox:"0 0 24 24"},Vs={key:0,class:"absolute inset-0 bg-indigo-500/20 border-4 border-dashed border-indigo-500 rounded-lg flex items-center justify-center z-50"},As={class:"px-4 py-3 bg-slate-800/80 border-t border-white/10 flex items-center gap-3 backdrop-blur-xl"},Ns={key:1,class:"flex-1 px-5 py-3 rounded-xl bg-slate-700/50 border border-white/10 flex items-center justify-between"},Ss={class:"flex items-center gap-3"},Ps={class:"text-white font-mono text-sm"},Os=["disabled"],Hs={key:3,class:"flex gap-2"},Ks={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ws={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Zs={key:1,class:"flex-1 flex flex-col items-center justify-center text-slate-400"},Gs={key:0,class:"hidden xl:flex w-80 bg-slate-900 border-l border-white/10 flex-col backdrop-blur-xl shrink-0 transition-all"},qs={key:0,class:"flex-1 flex items-center justify-center text-slate-400"},Js={key:1,class:"flex-1 overflow-y-auto p-4 space-y-6"},Ys={class:"p-3 bg-slate-800/50 rounded-lg border border-white/5"},Qs={class:"text-white font-medium"},Xs={class:"text-slate-400 text-sm"},eo={class:"text-slate-400 text-sm"},to={class:"space-y-4"},so={class:"space-y-2 max-h-40 overflow-y-auto pr-1"},oo=["checked","onChange"],lo={class:"text-white block"},ao={key:0,class:"text-xs text-slate-500"},no={key:0,class:"text-xs text-slate-500 italic"},ro={class:"space-y-2"},io=["checked","onChange"],uo={class:"text-white"},co={key:0,class:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4"},po={class:"bg-slate-900 border border-white/10 rounded-xl max-w-lg w-full max-h-[90vh] flex flex-col overflow-hidden shadow-2xl"},vo={class:"flex items-center justify-between p-4 border-b border-white/10"},go={class:"flex items-center gap-3"},fo={class:"text-white font-medium"},mo={class:"flex-1 overflow-y-auto p-4 bg-slate-800/50"},ho={key:0,class:"flex items-center justify-center min-h-[200px]"},xo=["src"],bo={key:1,class:"text-center"},wo={class:"text-white font-medium"},yo={class:"text-slate-400 text-sm"},ko={key:1,class:"flex gap-2 mt-4 justify-center flex-wrap"},Co=["onClick"],_o=["src"],Mo={key:1,class:"w-16 h-16 bg-slate-700 flex items-center justify-center"},jo=["onClick"],Do={class:"p-4 bg-slate-800 border-t border-white/10"},To={class:"flex items-center gap-3"},Io=["disabled"],Lo={key:1,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"},Bo={class:"bg-slate-900 border border-white/10 rounded-xl max-w-sm w-full shadow-2xl overflow-hidden"},$o={class:"p-4 bg-indigo-600 flex justify-between items-center"},Uo={class:"p-6 space-y-4"},Eo={class:"relative"},zo=["value"],Ro=["disabled"],Fo={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},Vo={key:2,class:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50"},Ao={class:"bg-slate-800 rounded-2xl p-6 w-full max-w-md border border-white/10 shadow-2xl"},No={class:"text-sm text-slate-400 mb-4"},So={class:"space-y-4"},Po=["value"],Oo={class:"flex gap-3 pt-2"},Ho=["disabled"],Ko={key:3,class:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50"},Wo={class:"bg-slate-800 rounded-2xl p-6 w-full max-w-lg border border-white/10 shadow-2xl max-h-[80vh] overflow-hidden flex flex-col"},Zo={class:"flex justify-between items-center mb-4"},Go={key:0,class:"text-center text-slate-400 py-8"},qo={key:1,class:"space-y-3 overflow-y-auto flex-1"},Jo={class:"flex justify-between items-start"},Yo={class:"text-white font-medium"},Qo={class:"text-sm text-slate-400"},Xo={key:0,class:"text-sm text-amber-400 mt-1"},el=["onClick"],tl={__name:"Index",props:{initialContacts:Array,catalogs:{type:Object,default:()=>({})}},setup(Z){const Oe=Z,ke=It(),Ce=V(()=>ke.props.auth.user),He=V(()=>ke.props.auth?.user?.tenant||{});n(!1);const A=n(!1),Ke=()=>{Et.post(route("logout"))},k=n(Oe.initialContacts),d=n(null),_=n([]),G=n(null),q=n(""),We=n(null),Ze=n(null),J=n(!1),U=n("all"),Y=n([]),T=n([]),Q=n(!1),E=n(null),X=n(""),re=n(!1);n([]);const Ge=V(()=>Ce.value?.role?.name==="tenant_admin"),qe=n(!0),ie=n(!1),h=n({nivel_interes:"",estado_crm:"",notas_crm:"",sedes:[],carreras:[],ofertas:[],eventos:[]}),Je=async o=>{ie.value=!0;try{const e=await v.get(route("chat.contact.details",o));h.value=e.data}catch(e){console.error("Error fetching CRM data",e)}finally{ie.value=!1}},Ye=async()=>{if(d.value)try{await v.put(route("chat.contact.update",d.value.id),h.value)}catch(o){console.error("Failed to update CRM",o),alert("Error al guardar datos CRM")}},_e=(o,e)=>{const s=h.value[o],i=s.indexOf(e);i>-1?s.splice(i,1):s.push(e)},N=n(!1),de=n("591"),z=n(""),ee=n(""),S=n([]),P=n(!1);ae(N,o=>{o&&S.value.length===0&&Qe()});const Qe=async()=>{try{const o=await v.get("/debug-templates");o.data&&o.data.data&&(S.value=o.data.data.filter(e=>e.status==="APPROVED").map(e=>({name:e.name,language:e.language})),S.value.length>0&&(ee.value=S.value[0].name))}catch(o){console.error("Error fetching templates",o)}},Me=V(()=>k.value.reduce((o,e)=>o+(e.unread||0),0)),je=async()=>{if(z.value){P.value=!0;try{const o=de.value+z.value,s=(await v.post(route("chat.initiate"),{phone:o,template:ee.value})).data,i=k.value.findIndex(m=>m.id===s.id);i===-1?(k.value.unshift({...s,relativeDate:pe(s.time,!0),formattedTime:K(s.time)}),ve(k.value[0])):ve(k.value[i]),N.value=!1,z.value=""}catch(o){console.error("Error initiating chat",o),alert("Error al iniciar chat")}finally{P.value=!1}}},te=n(!1),c=n([]),R=n(""),C=n(0),M=n(!1),O=n(0),f=n(null),H=n([]),ue=n(null);let ce=null;const Xe=["Domingo","Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado"],et=["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],K=o=>{if(!o)return"";let e;return o.includes("T")&&(o.includes("+")||o.includes("Z"))?e=new Date(o):e=new Date(o.replace(" ","T")+"Z"),isNaN(e.getTime())?o:e.toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"})},pe=(o,e=!1)=>{if(!o)return"";let s;if(o.includes("T")&&(o.includes("+")||o.includes("Z"))?s=new Date(o):s=new Date(o.replace(" ","T")+"Z"),isNaN(s.getTime()))return o;const i=new Date,m=new Date(i.getFullYear(),i.getMonth(),i.getDate()),D=new Date(s.getFullYear(),s.getMonth(),s.getDate()),p=Math.floor((m-D)/(1e3*60*60*24));return p===0?e?K(o):"Hoy":p===1?"Ayer":p===2?"Anteayer":p<7?Xe[s.getDay()]:`${s.getDate()} ${et[s.getMonth()]}`},tt=o=>{if(!o)return"";let e;return o.includes("T")&&(o.includes("+")||o.includes("Z"))?e=new Date(o):e=new Date(o.replace(" ","T")+"Z"),`${e.getFullYear()}-${e.getMonth()}-${e.getDate()}`},st=o=>{if(!o)return"";let e=o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e=e.replace(/\sâ€¢\s/g,`
â€¢ `),e=e.replace(/:\s*â€¢/g,`:
â€¢`),e=e.replace(/\s(\d+)\.\s(?=[A-Z])/g,`
$1. `);const s=/(https?:\/\/[^\s<]+[^\s<.,;:!?"'\])>])/gi;return e=e.replace(s,'<a href="$1" target="_blank" rel="noopener" class="text-indigo-300 hover:text-indigo-200 underline break-all">$1</a>'),e=e.replace(/\*([^*\n]+)\*/g,'<strong class="font-bold">$1</strong>'),e=e.replace(/_([^_\n]+)_/g,'<em class="italic">$1</em>'),e=e.replace(/~([^~\n]+)~/g,'<del class="line-through">$1</del>'),e=e.replace(/```([^`]+)```/g,'<code class="bg-black/30 px-1.5 py-0.5 rounded text-sm font-mono">$1</code>'),e=e.replace(/`([^`\n]+)`/g,'<code class="bg-black/30 px-1 rounded text-sm font-mono">$1</code>'),e=e.split(`
`).map(D=>{const p=D.trim();return p.match(/^â€¢\s*/)?'<div class="flex gap-2 items-start"><span class="text-indigo-300 mt-0.5">â€¢</span><span>'+p.replace(/^â€¢\s*/,"")+"</span></div>":p.match(/^[-]\s+/)?'<div class="flex gap-2 items-start"><span class="text-indigo-300 mt-0.5">â€¢</span><span>'+p.replace(/^[-]\s+/,"")+"</span></div>":p.match(/^\d+\.\s+/)?'<div class="flex gap-2 items-start"><span class="text-indigo-300 font-medium">'+p.match(/^(\d+)\./)[1]+".</span><span>"+p.replace(/^\d+\.\s+/,"")+"</span></div>":D}).join("<br>"),e=e.replace(/<br><div/g,"<div"),e},De=V(()=>{if(!q.value.trim())return k.value;const o=q.value.toLowerCase();return k.value.filter(e=>e.name&&e.name.toLowerCase().includes(o)||e.lastMessage&&e.lastMessage.toLowerCase().includes(o))}),ot=V(()=>{const o=[];let e=null;return _.value.forEach(s=>{const i=tt(s.rawDate);i!==e&&(o.push({type:"separator",date:pe(s.rawDate),key:"sep-"+i}),e=i),o.push({type:"message",...s})}),o}),lt=async()=>{await be(),setTimeout(()=>{G.value&&(G.value.scrollTop=G.value.scrollHeight)},100)};ae(_,()=>{lt()},{deep:!0});const ve=async o=>{if(d.value=o,_.value=[],Te(),Je(o.id),o.unread>0)try{await v.post(route("chat.read",o.id));const e=k.value.findIndex(s=>s.id===o.id);e!==-1&&(k.value[e].unread=0)}catch(e){console.error("Error marking as read",e)}},Te=async()=>{if(d.value)try{const e=(await v.get(route("chat.messages",d.value.id))).data.map(s=>({id:s.id,text:s.body,sender:s.direction==="outgoing"?"me":"them",time:K(s.created_at),rawDate:s.created_at,msgType:s.type,metadata:(()=>{if(!s.metadata)return null;if(typeof s.metadata=="object")return s.metadata;try{return JSON.parse(s.metadata)}catch(i){return console.error("Error parsing metadata",i,s.metadata),null}})()}));e.length!==_.value.length&&(_.value=e)}catch(o){console.error("Error loading messages",o)}},se=async()=>{try{const o=await v.get(route("chat.filter"),{params:{filter:U.value}});k.value=o.data.map(e=>({...e,relativeDate:pe(e.time,!0),formattedTime:K(e.time)}))}catch(o){console.error("Error fetching filtered contacts",o)}},Ie=async()=>{try{const o=await v.get(route("chat.team"));Y.value=o.data}catch(o){console.error("Error fetching team members",o)}},Le=async()=>{try{const o=await v.get(route("chat.notifications"));T.value=o.data}catch(o){console.error("Error fetching notifications",o)}},at=()=>{d.value&&(Y.value.length===0&&Ie(),E.value=null,X.value="",Q.value=!0)},nt=async()=>{if(!(!d.value||!E.value))try{await v.post(route("chat.transfer",d.value.id),{to_user_id:E.value,notes:X.value}),Q.value=!1,alert("Chat transferido exitosamente"),await se(),d.value=null}catch(o){console.error("Error transferring chat",o),alert("Error al transferir chat")}},rt=async o=>{try{await v.post(route("chat.transfer.seen",o.id)),T.value=T.value.filter(e=>e.id!==o.id)}catch(e){console.error("Error marking notification seen",e)}},oe=async o=>{U.value=o,await se()};ae(U,()=>{se()});const I=n(""),F=n(!1),x=n(null),it=n("auto"),dt=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),Be()),be(()=>{x.value&&(x.value.style.height="auto",x.value.style.height=Math.min(x.value.scrollHeight,128)+"px")})};ae(I,()=>{be(()=>{x.value&&(x.value.style.height="auto",x.value.style.height=Math.min(x.value.scrollHeight,128)+"px")})});const Be=async()=>{if(!I.value.trim()||!d.value)return;const o=I.value;I.value="",F.value=!0,x.value&&(x.value.style.height="auto");const e=new Date().toISOString(),s=Date.now();_.value.push({id:s,text:o,sender:"me",time:K(e),rawDate:e});try{await v.post(route("chat.send",d.value.id),{message:o})}catch(i){console.error("Failed to send",i),alert("Error al enviar mensaje")}finally{F.value=!1}},$e=o=>{if(!o)return"?";const e=o.split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():o.substring(0,2).toUpperCase()},Ue=o=>{if(!o)return"bg-slate-500";const e=["bg-indigo-500","bg-purple-500","bg-pink-500","bg-rose-500","bg-orange-500","bg-teal-500","bg-cyan-500","bg-emerald-500"],s=o.charCodeAt(0)%e.length;return e[s]},ut=o=>{window.open(o,"_blank")},ge=o=>{if(o.metadata?.filename)return o.metadata.filename;if(o.text&&!o.text.includes("/"))return o.text;if(o.text?.includes("/")){const e=o.text.split("/");return e[e.length-1]||"Documento"}return"Documento"},fe=o=>ge(o).split(".").pop()?.toUpperCase()||"Archivo",Ee=o=>o.metadata?.local_url?o.metadata.local_url:o.text?.startsWith("http")?o.text:`/storage/chat-media/${o.text}`,ct=o=>{const e=fe(o).toLowerCase();return{pdf:"bg-red-500",doc:"bg-blue-600",docx:"bg-blue-600",xls:"bg-green-600",xlsx:"bg-green-600",txt:"bg-gray-500"}[e]||"bg-slate-500"},pt=o=>{const e=fe(o).toUpperCase();return e.length>4?e.substring(0,4):e},vt=o=>{const e=Ee(o);window.open(e,"_blank")},gt=async(o,e="")=>{const s=new FormData;s.append("image",o),e&&s.append("caption",e);const i=Date.now()+Math.random(),m=URL.createObjectURL(o);_.value.push({id:i,text:m,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"image",metadata:e?{caption:e}:null});try{await v.post(route("chat.sendImage",d.value.id),s,{headers:{"Content-Type":"multipart/form-data"}})}catch(D){console.error("Failed to send image",D)}},ft=async o=>{const e=new FormData;e.append("document",o),e.append("filename",o.name);const s=Date.now()+Math.random();_.value.push({id:s,text:o.name,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"document"});try{await v.post(route("chat.sendDocument",d.value.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(i){console.error("Failed to send document",i)}},mt=async()=>{try{const o=await navigator.mediaDevices.getUserMedia({audio:!0});let e={};MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?e={mimeType:"audio/webm;codecs=opus"}:MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")?e={mimeType:"audio/ogg;codecs=opus"}:MediaRecorder.isTypeSupported("audio/mp4")?e={mimeType:"audio/mp4"}:console.warn("Using default MediaRecorder mimeType"),f.value=new MediaRecorder(o,e),H.value=[],f.value.ondataavailable=s=>{H.value.push(s.data)},f.value.onstop=()=>{o.getTracks().forEach(s=>s.stop())},f.value.start(200),M.value=!0,O.value=0,ue.value=setInterval(()=>{O.value++},1e3)}catch(o){console.error("Error accessing microphone",o),alert("No se pudo acceder al micrÃ³fono")}},ht=()=>{f.value&&(f.value.onstop=async()=>{const o=f.value.mimeType,e=new Blob(H.value,{type:o}),s=await bt(e);await yt(s),M.value=!1,clearInterval(ue.value),O.value=0,H.value=[]},f.value.stop())},xt=()=>{f.value&&M.value&&(f.value.stop(),M.value=!1,clearInterval(ue.value),O.value=0,H.value=[],f.value.stream&&f.value.stream.getTracks().forEach(o=>o.stop()))},bt=async o=>{try{window.lamejs||await new Promise((b,L)=>{const B=document.createElement("script");B.src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.min.js",B.onload=b,B.onerror=L,document.head.appendChild(B)});const e=await o.arrayBuffer(),s=new AudioContext,i=await s.decodeAudioData(e),m=1,D=i.sampleRate,p=new window.lamejs.Mp3Encoder(m,D,128),le=i.getChannelData(0),he=new Int16Array(le.length);for(let b=0;b<le.length;b++){const L=Math.max(-1,Math.min(1,le[b]));he[b]=L<0?L*32768:L*32767}const xe=[],Fe=1152;for(let b=0;b<he.length;b+=Fe){const L=he.subarray(b,b+Fe),B=p.encodeBuffer(L);B.length>0&&xe.push(B)}const Ve=p.flush();Ve.length>0&&xe.push(Ve),await s.close();const Tt=new Blob(xe,{type:"audio/mpeg"});return new File([Tt],"voice_note.mp3",{type:"audio/mpeg"})}catch(e){return console.error("MP3 conversion failed:",e),new File([o],"voice_note.ogg",{type:"audio/ogg"})}},wt=o=>{const e=Math.floor(o/60),s=o%60;return`${e}:${s.toString().padStart(2,"0")}`},yt=async o=>{const e=new FormData;e.append("audio",o);const s=Date.now()+Math.random(),i=URL.createObjectURL(o);_.value.push({id:s,text:i,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"audio"});try{await v.post(route("chat.sendAudio",d.value.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(m){console.error("Failed to send audio",m),alert("Error al enviar audio")}},kt=o=>{const e=Array.from(o.target.files);!e.length||!d.value||(me(e),o.target.value="")},Ct=o=>{const e=Array.from(o.target.files);!e.length||!d.value||(me(e),o.target.value="")},me=o=>{c.value=o.map(e=>({file:e,name:e.name,type:e.type,isImage:e.type.startsWith("image/"),preview:e.type.startsWith("image/")?URL.createObjectURL(e):null,size:(e.size/1024).toFixed(1)+" KB"})),C.value=0,R.value="",te.value=!0},ze=()=>{c.value.forEach(o=>{o.preview&&URL.revokeObjectURL(o.preview)}),c.value=[],R.value="",te.value=!1},_t=o=>{c.value[o].preview&&URL.revokeObjectURL(c.value[o].preview),c.value.splice(o,1),c.value.length===0?ze():C.value>=c.value.length&&(C.value=c.value.length-1)},Re=async()=>{if(!c.value.length||!d.value)return;te.value=!1,F.value=!0;const o=R.value;for(const e of c.value)e.isImage?await gt(e.file,o):await ft(e.file);c.value.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)}),c.value=[],R.value="",F.value=!1},Mt=o=>{o.preventDefault(),J.value=!0},jt=()=>{J.value=!1},Dt=o=>{if(o.preventDefault(),J.value=!1,!d.value)return;const e=Array.from(o.dataTransfer.files);e.length&&me(e)};return Lt(()=>{Ie(),Le(),ce=setInterval(()=>{se(),Le(),d.value&&Te()},5e3)}),Bt(()=>{ce&&clearInterval(ce)}),(o,e)=>(a(),l(g,null,[we(ye($t),{title:"Chat WhatsApp"}),t("div",Ft,[t("div",Vt,[t("div",At,[t("div",Nt,[t("span",St,r(He.value?.name?.charAt(0)||"C"),1)])]),t("nav",Pt,[we(ye(Ne),{href:o.route("tenant.dashboard"),class:"flex items-center justify-center p-3 mx-2 rounded-xl text-slate-400 hover:bg-white/10 hover:text-white transition-colors",title:"Dashboard"},{default:Ae(()=>[...e[25]||(e[25]=[t("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)])]),_:1},8,["href"]),e[26]||(e[26]=t("div",{class:"flex items-center justify-center p-3 mx-2 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg"},[t("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1))]),t("div",Ot,[t("button",{onClick:e[0]||(e[0]=s=>A.value=!A.value),class:"relative w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center mx-auto"},[t("span",Ht,r(Ce.value?.name?.charAt(0)||"U"),1)]),A.value?(a(),l("div",Kt,[we(ye(Ne),{href:o.route("tenant.settings"),class:"flex items-center gap-2 px-4 py-2.5 text-sm text-slate-300 hover:bg-white/10"},{default:Ae(()=>[...e[27]||(e[27]=[W(" ConfiguraciÃ³n",-1)])]),_:1},8,["href"]),t("button",{onClick:Ke,class:"flex w-full items-center gap-2 px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10"},"Cerrar SesiÃ³n")])):u("",!0)])]),t("div",Wt,[t("div",Zt,[t("div",Gt,[t("div",qt,[e[28]||(e[28]=t("h2",{class:"text-white font-semibold text-lg"},"Conversaciones",-1)),Me.value>0?(a(),l("span",Jt,r(Me.value),1)):u("",!0)]),t("button",{onClick:e[1]||(e[1]=s=>N.value=!0),class:"p-2 bg-indigo-500/20 hover:bg-indigo-500/30 rounded-lg text-indigo-400 transition-colors",title:"Nuevo Chat"},[...e[29]||(e[29]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])]),t("div",Yt,[e[30]||(e[30]=t("svg",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>q.value=s),type:"text",placeholder:"Buscar chat...",class:"w-full pl-10 pr-4 py-2.5 rounded-xl bg-slate-700/50 border border-white/10 text-white text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},null,512),[[$,q.value]])])]),t("div",Qt,[t("button",{onClick:e[3]||(e[3]=s=>oe("all")),class:y([U.value==="all"?"bg-indigo-500 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700","px-3 py-1.5 rounded-lg text-xs font-medium transition-colors"])}," Todos ",2),t("button",{onClick:e[4]||(e[4]=s=>oe("general")),class:y([U.value==="general"?"bg-indigo-500 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700","px-3 py-1.5 rounded-lg text-xs font-medium transition-colors"])}," General ",2),t("button",{onClick:e[5]||(e[5]=s=>oe("mine")),class:y([U.value==="mine"?"bg-indigo-500 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700","px-3 py-1.5 rounded-lg text-xs font-medium transition-colors"])}," Mis Chats ",2),Ge.value?(a(),l("select",{key:0,onChange:e[6]||(e[6]=s=>oe("user:"+s.target.value)),class:"ml-auto px-2 py-1.5 rounded-lg bg-slate-700/50 text-slate-300 text-xs border border-white/10"},[e[31]||(e[31]=t("option",{value:""},"Por Usuario",-1)),(a(!0),l(g,null,j(Y.value,s=>(a(),l("option",{key:s.id,value:s.id},r(s.name),9,Xt))),128))],32)):u("",!0),T.value.length>0?(a(),l("button",{key:1,onClick:e[7]||(e[7]=s=>re.value=!0),class:"relative p-1.5 rounded-lg bg-amber-500/20 text-amber-400 hover:bg-amber-500/30 transition-colors"},[e[32]||(e[32]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),t("span",es,r(T.value.length),1)])):u("",!0)]),t("div",ts,[De.value.length===0?(a(),l("div",ss,[...e[33]||(e[33]=[t("svg",{class:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),t("p",{class:"text-sm"},"No hay conversaciones",-1)])])):u("",!0),(a(!0),l(g,null,j(De.value,s=>(a(),l("div",{key:s.id,onClick:i=>ve(s),class:y(["flex items-center p-4 cursor-pointer border-b border-white/5 transition-all duration-200 hover:bg-white/5",{"bg-indigo-500/20 border-l-4 border-l-indigo-500":d.value&&d.value.id===s.id}])},[t("div",{class:y([Ue(s.name),"w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-sm shadow-md"])},r($e(s.name)),3),t("div",ls,[t("div",as,[t("h3",ns,r(s.name),1),t("span",rs,r(s.relativeDate||s.formattedTime),1)]),t("p",is,r(s.lastMessage||"Sin mensajes"),1)]),s.unread>0?(a(),l("div",ds,r(s.unread),1)):u("",!0)],10,os))),128))])]),t("div",{class:"flex-1 flex flex-col bg-slate-900/50 min-h-0 relative",onDragover:Mt,onDragleave:jt,onDrop:Dt},[d.value?(a(),l("div",us,[t("div",cs,[t("div",ps,[t("div",{class:y([Ue(d.value.name),"w-11 h-11 rounded-full flex items-center justify-center text-white font-semibold shadow-md"])},r($e(d.value.name)),3),t("div",vs,[t("h3",gs,r(d.value.name),1),d.value.assigned_user?(a(),l("p",fs," Asignado a: "+r(d.value.assigned_user),1)):(a(),l("p",ms,"Pool General"))])]),d.value.assigned_to?(a(),l("button",{key:0,onClick:at,class:"px-3 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-lg text-sm font-medium transition-colors flex items-center gap-1",title:"Transferir chat"},[...e[34]||(e[34]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1),W(" Transferir ",-1)])])):u("",!0)]),t("div",{ref_key:"messageContainer",ref:G,class:"flex-1 overflow-y-auto px-6 py-4 min-h-0"},[(a(!0),l(g,null,j(ot.value,s=>(a(),l(g,{key:s.key||s.id},[s.type==="separator"?(a(),l("div",hs,[t("span",xs,r(s.date),1)])):(a(),l("div",{key:1,class:y(["flex mb-2",s.sender==="me"?"justify-end":"justify-start"])},[t("div",{class:y(["max-w-[70%] px-3 py-2 rounded-xl shadow-sm relative",s.sender==="me"?"bg-indigo-600 rounded-br-sm":"bg-slate-700 rounded-bl-sm"])},[s.msgType==="image"?(a(),l(g,{key:0},[t("img",{src:s.text,alt:"Imagen",class:"max-w-[280px] max-h-[300px] rounded-lg cursor-pointer hover:opacity-90 object-cover",onClick:i=>ut(s.text)},null,8,bs),s.metadata?.caption?(a(),l("p",ws,r(s.metadata.caption),1)):u("",!0)],64)):s.msgType==="document"?(a(),l(g,{key:1},[t("div",ys,[t("div",{class:y(["flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center",ct(s)])},[t("span",ks,r(pt(s)),1)],2),t("div",Cs,[t("p",_s,r(ge(s)),1),t("p",Ms,r(fe(s)),1)])]),t("div",js,[t("button",{onClick:i=>vt(s),class:"text-indigo-300 hover:text-indigo-200 font-medium"},"Abrir",8,Ds),t("a",{href:Ee(s),download:ge(s),class:"text-indigo-300 hover:text-indigo-200 font-medium"},"Descargar",8,Ts)])],64)):s.msgType==="audio"?(a(),l("div",Is,[t("audio",Ls,[t("source",{src:s.text.startsWith("http")||s.text.startsWith("blob:")?s.text:`/storage/${s.text.replace("public/","")}`,type:"audio/mpeg"},null,8,Bs),t("source",{src:s.text.startsWith("http")||s.text.startsWith("blob:")?s.text:`/storage/${s.text.replace("public/","")}`,type:"audio/ogg"},null,8,$s),t("source",{src:s.text.startsWith("http")||s.text.startsWith("blob:")?s.text:`/storage/${s.text.replace("public/","")}`,type:"audio/webm"},null,8,Us),e[35]||(e[35]=W(" Tu navegador no soporta audio. ",-1))])])):(a(),l("div",{key:3,class:"text-sm text-white break-words leading-relaxed",innerHTML:st(s.text)},null,8,Es)),t("div",zs,[t("span",Rs,r(s.time),1),s.sender==="me"?(a(),l("svg",Fs,[...e[36]||(e[36]=[t("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"},null,-1)])])):u("",!0)])],2)],2))],64))),128))],512),J.value?(a(),l("div",Vs,[...e[37]||(e[37]=[t("div",{class:"text-center"},[t("svg",{class:"w-16 h-16 mx-auto text-indigo-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),t("p",{class:"text-lg font-semibold text-indigo-300"},"Suelta tus archivos aquÃ­")],-1)])])):u("",!0),t("div",As,[t("input",{type:"file",ref_key:"imageInput",ref:We,accept:"image/*",multiple:"",class:"hidden",onChange:kt},null,544),t("input",{type:"file",ref_key:"documentInput",ref:Ze,multiple:"",class:"hidden",onChange:Ct},null,544),t("button",{onClick:e[8]||(e[8]=s=>o.$refs.imageInput.click()),class:"p-2 rounded-lg hover:bg-white/10 text-slate-400 transition-colors",title:"Enviar imagen"},[...e[38]||(e[38]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]),t("button",{onClick:e[9]||(e[9]=s=>o.$refs.documentInput.click()),class:"p-2 rounded-lg hover:bg-white/10 text-slate-400 transition-colors",title:"Enviar documento"},[...e[39]||(e[39]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])]),M.value?(a(),l("div",Ns,[t("div",Ss,[e[40]||(e[40]=t("span",{class:"relative flex h-3 w-3"},[t("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),t("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})],-1)),t("span",Ps,r(wt(O.value)),1)]),e[41]||(e[41]=t("span",{class:"text-slate-400 text-xs"},"Grabando audio...",-1))])):w((a(),l("textarea",{key:0,"onUpdate:modelValue":e[10]||(e[10]=s=>I.value=s),onKeydown:dt,ref_key:"messageInput",ref:x,placeholder:"Escribe un mensaje (Shift+Enter para nueva lÃ­nea)",rows:"1",class:"flex-1 px-5 py-3 rounded-xl bg-slate-700/50 border border-white/10 text-white text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none max-h-32 overflow-y-auto leading-relaxed",style:Ut({height:it.value})},null,36)),[[$,I.value]]),I.value.trim()?(a(),l("button",{key:2,onClick:Be,disabled:F.value,class:"p-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-lg"},[...e[42]||(e[42]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,Os)):(a(),l("div",Hs,[M.value?(a(),l("button",{key:0,onClick:xt,class:"p-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors shadow-lg",title:"Cancelar"},[...e[43]||(e[43]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):u("",!0),t("button",{onClick:e[11]||(e[11]=s=>M.value?ht():mt()),class:y(["p-3 text-white rounded-xl transition-colors shadow-lg",M.value?"bg-green-500 hover:bg-green-600":"bg-slate-700 hover:bg-slate-600"])},[M.value?(a(),l("svg",Ws,[...e[45]||(e[45]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("svg",Ks,[...e[44]||(e[44]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},null,-1)])]))],2)]))])])):(a(),l("div",Zs,[...e[46]||(e[46]=[Se('<div class="w-24 h-24 bg-slate-700/50 rounded-full flex items-center justify-center mb-4" data-v-b9970433><svg class="w-12 h-12 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-b9970433><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-b9970433></path></svg></div><h3 class="text-xl font-medium text-white mb-2" data-v-b9970433>Chat WhatsApp</h3><p class="text-sm" data-v-b9970433>Selecciona un chat para comenzar</p>',3)])]))],32),d.value&&qe.value?(a(),l("div",Gs,[t("div",{class:"p-4 border-b border-white/10 flex justify-between items-center"},[e[47]||(e[47]=t("h3",{class:"text-white font-semibold"},"CRM Contacto",-1)),t("button",{onClick:Ye,class:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium rounded-lg transition-colors"}," Guardar ")]),ie.value?(a(),l("div",qs,[...e[48]||(e[48]=[t("svg",{class:"animate-spin h-5 w-5 mr-2 text-white",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),W(" Cargando... ",-1)])])):(a(),l("div",Js,[t("div",Ys,[e[49]||(e[49]=t("p",{class:"text-xs text-slate-500 uppercase font-bold mb-2"},"Contacto",-1)),t("p",Qs,r(d.value.name),1),t("p",Xs,r(d.value.wa_id),1),t("p",eo,r(d.value.email||"Sin email"),1)]),t("div",to,[t("div",null,[e[51]||(e[51]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Nivel de InterÃ©s",-1)),w(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>h.value.nivel_interes=s),class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none"},[...e[50]||(e[50]=[t("option",{value:""},"-- Seleccionar --",-1),t("option",{value:"frio"},"â„ï¸ FrÃ­o",-1),t("option",{value:"tibio"},"ðŸ”¥ Tibio",-1),t("option",{value:"caliente"},"ðŸ’¥ Caliente",-1)])],512),[[ne,h.value.nivel_interes]])]),t("div",null,[e[53]||(e[53]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Estado CRM",-1)),w(t("select",{"onUpdate:modelValue":e[13]||(e[13]=s=>h.value.estado_crm=s),class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none"},[...e[52]||(e[52]=[Se('<option value="" data-v-b9970433>-- Seleccionar --</option><option value="prospecto" data-v-b9970433>Prospecto</option><option value="interesado" data-v-b9970433>Interesado</option><option value="inscrito" data-v-b9970433>Inscrito</option><option value="perdido" data-v-b9970433>Perdido</option>',5)])],512),[[ne,h.value.estado_crm]])])]),t("div",null,[e[54]||(e[54]=t("label",{class:"block text-xs font-medium text-slate-400 mb-2"},"Carreras de InterÃ©s",-1)),t("div",so,[(a(!0),l(g,null,j(Z.catalogs.carreras,s=>(a(),l("label",{key:s.id,class:"flex items-start gap-2 p-2 rounded hover:bg-white/5 cursor-pointer text-sm"},[t("input",{type:"checkbox",checked:h.value.carreras.includes(s.id),onChange:i=>_e("carreras",s.id),class:"mt-1 rounded bg-slate-700 border-slate-500 text-indigo-600 focus:ring-indigo-500"},null,40,oo),t("div",null,[t("span",lo,r(s.nombre),1),s.duracion?(a(),l("span",ao,r(s.duracion),1)):u("",!0)])]))),128)),Z.catalogs.carreras?.length?u("",!0):(a(),l("p",no,"No hay carreras disponibles"))])]),t("div",null,[e[55]||(e[55]=t("label",{class:"block text-xs font-medium text-slate-400 mb-2"},"Sedes Preferidas",-1)),t("div",ro,[(a(!0),l(g,null,j(Z.catalogs.sedes,s=>(a(),l("label",{key:s.id,class:"flex items-center gap-2 p-2 rounded hover:bg-white/5 cursor-pointer text-sm"},[t("input",{type:"checkbox",checked:h.value.sedes.includes(s.id),onChange:i=>_e("sedes",s.id),class:"rounded bg-slate-700 border-slate-500 text-indigo-600 focus:ring-indigo-500"},null,40,io),t("span",uo,r(s.nombre),1)]))),128))])]),t("div",null,[e[56]||(e[56]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Notas / Observaciones",-1)),w(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=s=>h.value.notas_crm=s),rows:"4",class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none placeholder-slate-600",placeholder:"Escribe notas aquÃ­..."},null,512),[[$,h.value.notas_crm]])]),e[57]||(e[57]=t("div",{class:"h-10"},null,-1))]))])):u("",!0),A.value?(a(),l("div",{key:1,onClick:e[15]||(e[15]=s=>A.value=!1),class:"fixed inset-0 z-40"})):u("",!0)]),te.value?(a(),l("div",co,[t("div",po,[t("div",vo,[t("div",go,[t("button",{onClick:ze,class:"p-2 hover:bg-white/10 rounded-full transition-colors"},[...e[58]||(e[58]=[t("svg",{class:"w-5 h-5 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),t("span",fo,r(c.value.length)+" archivo"+r(c.value.length>1?"s":""),1)])]),t("div",mo,[c.value[C.value]?(a(),l("div",ho,[c.value[C.value].isImage?(a(),l("img",{key:0,src:c.value[C.value].preview,class:"max-w-full max-h-[300px] rounded-lg object-contain"},null,8,xo)):(a(),l("div",bo,[e[59]||(e[59]=t("svg",{class:"w-20 h-20 mx-auto text-slate-500 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t("p",wo,r(c.value[C.value].name),1),t("p",yo,r(c.value[C.value].size),1)]))])):u("",!0),c.value.length>1?(a(),l("div",ko,[(a(!0),l(g,null,j(c.value,(s,i)=>(a(),l("div",{key:i,class:y(["relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all",C.value===i?"border-indigo-500":"border-transparent"]),onClick:m=>C.value=i},[s.isImage?(a(),l("img",{key:0,src:s.preview,class:"w-16 h-16 object-cover"},null,8,_o)):(a(),l("div",Mo,[...e[60]||(e[60]=[t("svg",{class:"w-8 h-8 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])])),t("button",{onClick:zt(m=>_t(i),["stop"]),class:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center shadow-lg"},[...e[61]||(e[61]=[t("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,jo)],10,Co))),128))])):u("",!0)]),t("div",Do,[t("div",To,[w(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>R.value=s),type:"text",placeholder:"Agregar un comentario...",class:"flex-1 bg-slate-700/50 text-white px-4 py-3 rounded-xl border border-white/10 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 placeholder-slate-400",onKeyup:Pe(Re,["enter"])},null,544),[[$,R.value]]),t("button",{onClick:Re,disabled:F.value,class:"p-3 bg-indigo-500 hover:bg-indigo-600 rounded-xl transition-colors disabled:opacity-50"},[...e[62]||(e[62]=[t("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,Io)])])])])):u("",!0),N.value?(a(),l("div",Lo,[t("div",Bo,[t("div",$o,[e[64]||(e[64]=t("h3",{class:"text-white font-semibold text-lg"},"Iniciar ConversaciÃ³n",-1)),t("button",{onClick:e[17]||(e[17]=s=>N.value=!1),class:"text-white/80 hover:text-white transition-colors"},[...e[63]||(e[63]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Uo,[t("div",null,[e[66]||(e[66]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Prefijo PaÃ­s",-1)),t("div",Eo,[e[65]||(e[65]=t("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium"},"+",-1)),w(t("input",{"onUpdate:modelValue":e[18]||(e[18]=s=>de.value=s),type:"text",class:"w-full pl-6 pr-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none",placeholder:"591"},null,512),[[$,de.value]])])]),t("div",null,[e[67]||(e[67]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"NÃºmero de TelÃ©fono",-1)),w(t("input",{"onUpdate:modelValue":e[19]||(e[19]=s=>z.value=s),type:"tel",class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none",placeholder:"70012345",onKeyup:Pe(je,["enter"])},null,544),[[$,z.value]])]),t("div",null,[e[69]||(e[69]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Plantilla de Inicio (Opcional)",-1)),w(t("select",{"onUpdate:modelValue":e[20]||(e[20]=s=>ee.value=s),class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none text-sm"},[e[68]||(e[68]=t("option",{value:""},"-- Ninguna --",-1)),(a(!0),l(g,null,j(S.value,s=>(a(),l("option",{key:s.name,value:s.name},r(s.name)+" ("+r(s.language)+") ",9,zo))),128))],512),[[ne,ee.value]]),e[70]||(e[70]=t("p",{class:"text-xs text-slate-400 mt-1"},"Si el contacto no te ha escrito en 24h, usa una plantilla. ",-1))]),t("button",{onClick:je,disabled:P.value||!z.value,class:"w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[P.value?(a(),l("span",Fo)):u("",!0),W(" "+r(P.value?"Iniciando...":"Iniciar Chat"),1)],8,Ro)])])])):u("",!0),Q.value?(a(),l("div",Vo,[t("div",Ao,[e[74]||(e[74]=t("h3",{class:"text-xl font-bold text-white mb-4"},"Transferir Chat",-1)),t("p",No,'Transferir "'+r(d.value?.name)+'" a otro usuario',1),t("div",So,[t("div",null,[e[72]||(e[72]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Usuario Destino",-1)),w(t("select",{"onUpdate:modelValue":e[21]||(e[21]=s=>E.value=s),class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 outline-none"},[e[71]||(e[71]=t("option",{value:null},"Seleccionar usuario...",-1)),(a(!0),l(g,null,j(Y.value,s=>(a(),l("option",{key:s.id,value:s.id},r(s.name)+" "+r(s.apellidos||""),9,Po))),128))],512),[[ne,E.value]])]),t("div",null,[e[73]||(e[73]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Nota (opcional)",-1)),w(t("textarea",{"onUpdate:modelValue":e[22]||(e[22]=s=>X.value=s),rows:"2",placeholder:"Motivo de la transferencia...",class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm resize-none"},null,512),[[$,X.value]])]),t("div",Oo,[t("button",{onClick:e[23]||(e[23]=s=>Q.value=!1),class:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors"}," Cancelar "),t("button",{onClick:nt,disabled:!E.value,class:"flex-1 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Transferir ",8,Ho)])])])])):u("",!0),re.value?(a(),l("div",Ko,[t("div",Wo,[t("div",Zo,[e[76]||(e[76]=t("h3",{class:"text-xl font-bold text-white"},"Chats Transferidos",-1)),t("button",{onClick:e[24]||(e[24]=s=>re.value=!1),class:"text-slate-400 hover:text-white"},[...e[75]||(e[75]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),T.value.length===0?(a(),l("div",Go," No tienes transferencias pendientes ")):(a(),l("div",qo,[(a(!0),l(g,null,j(T.value,s=>(a(),l("div",{key:s.id,class:"p-4 bg-slate-700/50 rounded-lg border border-white/10"},[t("div",Jo,[t("div",null,[t("p",Yo,r(s.contact?.name),1),t("p",Qo,"De: "+r(s.from_user?.name),1),s.notes?(a(),l("p",Xo,'"'+r(s.notes)+'"',1)):u("",!0)]),t("button",{onClick:i=>rt(s),class:"px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white text-xs rounded-lg transition-colors"}," Aceptar ",8,el)])]))),128))]))])])):u("",!0)],64))}},ll=Rt(tl,[["__scopeId","data-v-b9970433"]]);export{ll as default};

import{e as Ft,p as N,f as r,E as ie,G as v,H as de,B as Vt,I as At,c as l,a as Ce,b as t,d as u,u as Me,h as Nt,t as i,w as Se,l as Oe,q as Z,k as _,v as R,n as m,F as p,r as b,y as He,x as ue,J as We,s as Pt,o as n,j as Ke}from"./app-CvBBLmC7.js";import{_ as St}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ot={class:"h-screen flex bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900"},Ht={class:"hidden lg:flex w-16 flex-col bg-slate-900/80 border-r border-white/10"},Wt={class:"h-16 flex items-center justify-center border-b border-white/10"},Kt={class:"h-10 w-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center"},qt={class:"text-lg font-bold text-white"},Zt={class:"flex-1 py-4 space-y-2"},Qt={class:"p-3 border-t border-white/10"},Gt={class:"text-sm font-bold text-white"},Jt={key:0,class:"absolute bottom-16 left-2 w-48 rounded-lg bg-slate-800 border border-white/10 shadow-xl overflow-hidden z-50"},Yt={class:"w-80 bg-slate-800/50 border-r border-white/10 flex flex-col backdrop-blur-xl"},Xt={class:"p-4 border-b border-white/10"},es={class:"flex items-center justify-between mb-3"},ts={class:"flex items-center gap-2"},ss={key:0,class:"bg-indigo-500 text-white px-2 py-0.5 rounded-full text-xs font-bold"},os={class:"relative"},ls={class:"px-4 py-2 border-b border-white/10 flex items-center gap-2 flex-wrap"},ns=["value"],as={class:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center"},rs={class:"flex-1 overflow-y-auto"},is={key:0,class:"p-6 text-center text-slate-400"},ds=["onClick"],us={class:"ml-3 flex-1 min-w-0"},cs={class:"flex justify-between items-center mb-1"},ps={class:"font-semibold text-white truncate"},vs={class:"text-xs text-slate-400 whitespace-nowrap ml-2"},gs={class:"text-sm text-slate-400 truncate"},hs={key:0,class:"ml-2 bg-indigo-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center"},fs={key:0,class:"flex-1 flex flex-col min-h-0"},ms={class:"px-5 py-3 bg-slate-800/80 border-b border-white/10 flex items-center justify-between shrink-0 backdrop-blur-xl"},xs={class:"flex items-center"},bs={class:"ml-3"},ws={class:"font-semibold text-white"},ys={key:0,class:"text-xs text-amber-400"},ks={key:1,class:"text-xs text-green-400"},_s={key:0,class:"flex justify-center my-4"},Cs={class:"bg-slate-700/80 text-slate-300 text-xs font-medium px-4 py-1.5 rounded-full"},Ms=["src","onClick"],js={key:0,class:"text-sm text-white mt-2"},Ds={class:"flex items-start gap-3 min-w-[220px] p-2 bg-slate-600/50 rounded-lg"},Ts={class:"text-white text-xs font-bold"},Is={class:"flex-1 min-w-0"},Ls={class:"text-sm font-medium text-white truncate"},$s={class:"text-xs text-slate-300 mt-0.5"},Bs={class:"flex gap-4 mt-2 text-sm"},Rs=["onClick"],Us=["href","download"],Es={key:2,class:"flex items-center gap-3 min-w-[200px] p-2"},zs={controls:"",class:"w-full max-w-[240px] h-8",controllerslist:"nodownload"},Fs=["src"],Vs=["src"],As=["src"],Ns=["innerHTML"],Ps={class:"flex items-center justify-end gap-1 mt-1"},Ss={class:"text-[10px] text-white/60"},Os={key:0,class:"w-4 h-4 text-white/60",fill:"currentColor",viewBox:"0 0 24 24"},Hs={key:0,class:"absolute inset-0 bg-indigo-500/20 border-4 border-dashed border-indigo-500 rounded-lg flex items-center justify-center z-50"},Ws={class:"px-4 py-3 bg-slate-800/80 border-t border-white/10 flex items-center gap-3 backdrop-blur-xl"},Ks={class:"relative"},qs={key:0,class:"absolute bottom-14 left-0 w-80 max-h-96 bg-slate-800 border border-white/10 rounded-xl shadow-2xl overflow-hidden z-50"},Zs={class:"px-4 py-3 bg-slate-700/50 border-b border-white/10 flex items-center justify-between"},Qs={key:0,class:"p-6 text-center text-slate-400"},Gs=["href"],Js={class:"flex overflow-x-auto gap-1 px-2 py-2 border-b border-white/10 bg-slate-700/30"},Ys=["onClick"],Xs={class:"max-h-60 overflow-y-auto"},eo={key:0},to=["onClick"],so={class:"flex items-center justify-between mb-1"},oo={class:"font-medium text-white text-sm"},lo=["onClick"],no={class:"text-xs text-slate-400 line-clamp-2"},ao={key:0,class:"mt-2"},ro=["src"],io={key:0,class:"p-4 text-center text-slate-400 text-sm"},uo={key:1,class:"flex-1 px-5 py-3 rounded-xl bg-slate-700/50 border border-white/10 flex items-center justify-between"},co={class:"flex items-center gap-3"},po={class:"text-white font-mono text-sm"},vo=["disabled"],go={key:3,class:"flex gap-2"},ho={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},fo={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},mo={key:1,class:"flex-1 flex flex-col items-center justify-center text-slate-400"},xo={key:0,class:"hidden xl:flex w-80 bg-slate-900 border-l border-white/10 flex-col backdrop-blur-xl shrink-0 transition-all"},bo={key:0,class:"flex-1 flex items-center justify-center text-slate-400"},wo={key:1,class:"flex-1 overflow-y-auto p-4 space-y-6"},yo={class:"p-3 bg-slate-800/50 rounded-lg border border-white/5"},ko={class:"text-white font-medium"},_o={class:"text-slate-400 text-sm"},Co={class:"text-slate-400 text-sm"},Mo={class:"space-y-4"},jo={class:"space-y-2 max-h-40 overflow-y-auto pr-1"},Do=["checked","onChange"],To={class:"text-white block"},Io={key:0,class:"text-xs text-slate-500"},Lo={key:0,class:"text-xs text-slate-500 italic"},$o={class:"space-y-2"},Bo=["checked","onChange"],Ro={class:"text-white"},Uo={key:0,class:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4"},Eo={class:"bg-slate-900 border border-white/10 rounded-xl max-w-lg w-full max-h-[90vh] flex flex-col overflow-hidden shadow-2xl"},zo={class:"flex items-center justify-between p-4 border-b border-white/10"},Fo={class:"flex items-center gap-3"},Vo={class:"text-white font-medium"},Ao={class:"flex-1 overflow-y-auto p-4 bg-slate-800/50"},No={key:0,class:"flex items-center justify-center min-h-[200px]"},Po=["src"],So={key:1,class:"text-center"},Oo={class:"text-white font-medium"},Ho={class:"text-slate-400 text-sm"},Wo={key:1,class:"flex gap-2 mt-4 justify-center flex-wrap"},Ko=["onClick"],qo=["src"],Zo={key:1,class:"w-16 h-16 bg-slate-700 flex items-center justify-center"},Qo=["onClick"],Go={class:"p-4 bg-slate-800 border-t border-white/10"},Jo={class:"flex items-center gap-3"},Yo=["disabled"],Xo={key:1,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"},el={class:"bg-slate-900 border border-white/10 rounded-xl max-w-sm w-full shadow-2xl overflow-hidden"},tl={class:"p-4 bg-indigo-600 flex justify-between items-center"},sl={class:"p-6 space-y-4"},ol={class:"relative"},ll=["value"],nl=["disabled"],al={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},rl={key:2,class:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50"},il={class:"bg-slate-800 rounded-2xl p-6 w-full max-w-md border border-white/10 shadow-2xl"},dl={class:"text-sm text-slate-400 mb-4"},ul={class:"space-y-4"},cl=["value"],pl={class:"flex gap-3 pt-2"},vl=["disabled"],gl={key:3,class:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50"},hl={class:"bg-slate-800 rounded-2xl p-6 w-full max-w-lg border border-white/10 shadow-2xl max-h-[80vh] overflow-hidden flex flex-col"},fl={class:"flex justify-between items-center mb-4"},ml={key:0,class:"text-center text-slate-400 py-8"},xl={key:1,class:"space-y-3 overflow-y-auto flex-1"},bl={class:"flex justify-between items-start"},wl={class:"text-white font-medium"},yl={class:"text-sm text-slate-400"},kl={key:0,class:"text-sm text-amber-400 mt-1"},_l=["onClick"],Cl={__name:"Index",props:{initialContacts:Array,catalogs:{type:Object,default:()=>({})}},setup(Q){const qe=Q,je=Ft(),De=N(()=>je.props.auth.user),Ze=N(()=>je.props.auth?.user?.tenant||{});r(!1);const P=r(!1),Qe=()=>{Pt.post(route("logout"))},C=r(qe.initialContacts),d=r(null),j=r([]),G=r(null),J=r(""),Ge=r(null),Je=r(null),Y=r(!1),U=r("all"),X=r([]),I=r([]),ee=r(!1),E=r(null),te=r(""),ce=r(!1);r([]);const Ye=N(()=>De.value?.role?.name==="tenant_admin"),L=r(!1),z=r([]),se=r(null),Xe=r(!0),pe=r(!1),w=r({nivel_interes:"",estado_crm:"",notas_crm:"",sedes:[],carreras:[],ofertas:[],eventos:[]}),et=async o=>{pe.value=!0;try{const e=await v.get(route("chat.contact.details",o));w.value=e.data}catch(e){console.error("Error fetching CRM data",e)}finally{pe.value=!1}},tt=async()=>{if(d.value)try{await v.put(route("chat.contact.update",d.value.id),w.value)}catch(o){console.error("Failed to update CRM",o),alert("Error al guardar datos CRM")}},Te=(o,e)=>{const s=w.value[o],a=s.indexOf(e);a>-1?s.splice(a,1):s.push(e)},S=r(!1),ve=r("591"),F=r(""),oe=r(""),O=r([]),H=r(!1);ie(S,o=>{o&&O.value.length===0&&st()});const st=async()=>{try{const o=await v.get("/debug-templates");o.data&&o.data.data&&(O.value=o.data.data.filter(e=>e.status==="APPROVED").map(e=>({name:e.name,language:e.language})),O.value.length>0&&(oe.value=O.value[0].name))}catch(o){console.error("Error fetching templates",o)}},Ie=N(()=>C.value.reduce((o,e)=>o+(e.unread||0),0)),Le=async()=>{if(F.value){H.value=!0;try{const o=ve.value+F.value,s=(await v.post(route("chat.initiate"),{phone:o,template:oe.value})).data,a=C.value.findIndex(h=>h.id===s.id);a===-1?(C.value.unshift({...s,relativeDate:fe(s.time,!0),formattedTime:q(s.time)}),me(C.value[0])):me(C.value[a]),S.value=!1,F.value=""}catch(o){console.error("Error initiating chat",o),alert("Error al iniciar chat")}finally{H.value=!1}}},le=r(!1),c=r([]),V=r(""),M=r(0),D=r(!1),W=r(0),x=r(null),K=r([]),ge=r(null);let he=null;const ot=["Domingo","Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado"],lt=["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],q=o=>{if(!o)return"";let e;return o.includes("T")&&(o.includes("+")||o.includes("Z"))?e=new Date(o):e=new Date(o.replace(" ","T")+"Z"),isNaN(e.getTime())?o:e.toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"})},fe=(o,e=!1)=>{if(!o)return"";let s;if(o.includes("T")&&(o.includes("+")||o.includes("Z"))?s=new Date(o):s=new Date(o.replace(" ","T")+"Z"),isNaN(s.getTime()))return o;const a=new Date,h=new Date(a.getFullYear(),a.getMonth(),a.getDate()),T=new Date(s.getFullYear(),s.getMonth(),s.getDate()),g=Math.floor((h-T)/(1e3*60*60*24));return g===0?e?q(o):"Hoy":g===1?"Ayer":g===2?"Anteayer":g<7?ot[s.getDay()]:`${s.getDate()} ${lt[s.getMonth()]}`},nt=o=>{if(!o)return"";let e;return o.includes("T")&&(o.includes("+")||o.includes("Z"))?e=new Date(o):e=new Date(o.replace(" ","T")+"Z"),`${e.getFullYear()}-${e.getMonth()}-${e.getDate()}`},at=o=>{if(!o)return"";let e=o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e=e.replace(/\sâ€¢\s/g,`
â€¢ `),e=e.replace(/:\s*â€¢/g,`:
â€¢`),e=e.replace(/\s(\d+)\.\s(?=[A-Z])/g,`
$1. `);const s=/(https?:\/\/[^\s<]+[^\s<.,;:!?"'\])>])/gi;return e=e.replace(s,'<a href="$1" target="_blank" rel="noopener" class="text-indigo-300 hover:text-indigo-200 underline break-all">$1</a>'),e=e.replace(/\*([^*\n]+)\*/g,'<strong class="font-bold">$1</strong>'),e=e.replace(/_([^_\n]+)_/g,'<em class="italic">$1</em>'),e=e.replace(/~([^~\n]+)~/g,'<del class="line-through">$1</del>'),e=e.replace(/```([^`]+)```/g,'<code class="bg-black/30 px-1.5 py-0.5 rounded text-sm font-mono">$1</code>'),e=e.replace(/`([^`\n]+)`/g,'<code class="bg-black/30 px-1 rounded text-sm font-mono">$1</code>'),e=e.split(`
`).map(T=>{const g=T.trim();return g.match(/^â€¢\s*/)?'<div class="flex gap-2 items-start"><span class="text-indigo-300 mt-0.5">â€¢</span><span>'+g.replace(/^â€¢\s*/,"")+"</span></div>":g.match(/^[-]\s+/)?'<div class="flex gap-2 items-start"><span class="text-indigo-300 mt-0.5">â€¢</span><span>'+g.replace(/^[-]\s+/,"")+"</span></div>":g.match(/^\d+\.\s+/)?'<div class="flex gap-2 items-start"><span class="text-indigo-300 font-medium">'+g.match(/^(\d+)\./)[1]+".</span><span>"+g.replace(/^\d+\.\s+/,"")+"</span></div>":T}).join("<br>"),e=e.replace(/<br><div/g,"<div"),e},$e=N(()=>{if(!J.value.trim())return C.value;const o=J.value.toLowerCase();return C.value.filter(e=>e.name&&e.name.toLowerCase().includes(o)||e.lastMessage&&e.lastMessage.toLowerCase().includes(o))}),rt=N(()=>{const o=[];let e=null;return j.value.forEach(s=>{const a=nt(s.rawDate);a!==e&&(o.push({type:"separator",date:fe(s.rawDate),key:"sep-"+a}),e=a),o.push({type:"message",...s})}),o}),it=async()=>{await de(),setTimeout(()=>{G.value&&(G.value.scrollTop=G.value.scrollHeight)},100)};ie(j,()=>{it()},{deep:!0});const me=async o=>{if(d.value=o,j.value=[],Be(),et(o.id),o.unread>0)try{await v.post(route("chat.read",o.id));const e=C.value.findIndex(s=>s.id===o.id);e!==-1&&(C.value[e].unread=0)}catch(e){console.error("Error marking as read",e)}},Be=async()=>{if(d.value)try{const e=(await v.get(route("chat.messages",d.value.id))).data.map(s=>({id:s.id,text:s.body,sender:s.direction==="outgoing"?"me":"them",time:q(s.created_at),rawDate:s.created_at,msgType:s.type,metadata:(()=>{if(!s.metadata)return null;if(typeof s.metadata=="object")return s.metadata;try{return JSON.parse(s.metadata)}catch(a){return console.error("Error parsing metadata",a,s.metadata),null}})()}));e.length!==j.value.length&&(j.value=e)}catch(o){console.error("Error loading messages",o)}},ne=async()=>{try{const o=await v.get(route("chat.filter"),{params:{filter:U.value}});C.value=o.data.map(e=>({...e,relativeDate:fe(e.time,!0),formattedTime:q(e.time)}))}catch(o){console.error("Error fetching filtered contacts",o)}},Re=async()=>{try{const o=await v.get(route("chat.team"));X.value=o.data}catch(o){console.error("Error fetching team members",o)}},Ue=async()=>{try{const o=await v.get(route("chat.notifications"));I.value=o.data}catch(o){console.error("Error fetching notifications",o)}},dt=()=>{d.value&&(X.value.length===0&&Re(),E.value=null,te.value="",ee.value=!0)},ut=async()=>{if(!(!d.value||!E.value))try{await v.post(route("chat.transfer",d.value.id),{to_user_id:E.value,notes:te.value}),ee.value=!1,alert("Chat transferido exitosamente"),await ne(),d.value=null}catch(o){console.error("Error transferring chat",o),alert("Error al transferir chat")}},ct=async o=>{try{await v.post(route("chat.transfer.seen",o.id)),I.value=I.value.filter(e=>e.id!==o.id)}catch(e){console.error("Error marking notification seen",e)}},ae=async o=>{U.value=o,await ne()};ie(U,()=>{ne()});const y=r(""),A=r(!1),f=r(null);r("auto");const pt=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),xe()),de(()=>{if(f.value){const e=window.innerWidth>=1024?256:window.innerWidth>=640?128:96;f.value.style.height="auto",f.value.style.height=Math.min(f.value.scrollHeight,e)+"px"}})},vt=o=>{let e=o.replace(/â€¢\s*\n\s*/g,"â€¢ ");return e=e.replace(/\n\s*â€¢/g,`
â€¢`),e=e.replace(/\n{3,}/g,`

`),e},gt=o=>{setTimeout(()=>{y.value=vt(y.value)},0)},ht=async()=>{try{const o=await v.get(route("quick-replies.index"));z.value=o.data,z.value.length>0&&(se.value=z.value[0].id)}catch(o){console.error("Error fetching quick replies:",o)}},ft=o=>{y.value=o.body,L.value=!1,o.image_url,de(()=>{f.value&&f.value.focus()})},mt=async o=>{y.value=o.body,L.value=!1,await xe()};ie(y,()=>{de(()=>{if(f.value){const o=window.innerWidth>=1024?256:window.innerWidth>=640?128:96;f.value.style.height="auto",f.value.style.height=Math.min(f.value.scrollHeight,o)+"px"}})});const xe=async()=>{if(!y.value.trim()||!d.value)return;const o=y.value;y.value="",A.value=!0,f.value&&(f.value.style.height="auto");const e=new Date().toISOString(),s=Date.now();j.value.push({id:s,text:o,sender:"me",time:q(e),rawDate:e});try{await v.post(route("chat.send",d.value.id),{message:o})}catch(a){console.error("Failed to send",a),alert("Error al enviar mensaje")}finally{A.value=!1}},Ee=o=>{if(!o)return"?";const e=o.split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():o.substring(0,2).toUpperCase()},ze=o=>{if(!o)return"bg-slate-500";const e=["bg-indigo-500","bg-purple-500","bg-pink-500","bg-rose-500","bg-orange-500","bg-teal-500","bg-cyan-500","bg-emerald-500"],s=o.charCodeAt(0)%e.length;return e[s]},xt=o=>{window.open(o,"_blank")},be=o=>{if(o.metadata?.filename)return o.metadata.filename;if(o.text&&!o.text.includes("/"))return o.text;if(o.text?.includes("/")){const e=o.text.split("/");return e[e.length-1]||"Documento"}return"Documento"},we=o=>be(o).split(".").pop()?.toUpperCase()||"Archivo",Fe=o=>o.metadata?.local_url?o.metadata.local_url:o.text?.startsWith("http")?o.text:`/storage/chat-media/${o.text}`,bt=o=>{const e=we(o).toLowerCase();return{pdf:"bg-red-500",doc:"bg-blue-600",docx:"bg-blue-600",xls:"bg-green-600",xlsx:"bg-green-600",txt:"bg-gray-500"}[e]||"bg-slate-500"},wt=o=>{const e=we(o).toUpperCase();return e.length>4?e.substring(0,4):e},yt=o=>{const e=Fe(o);window.open(e,"_blank")},kt=async(o,e="")=>{const s=new FormData;s.append("image",o),e&&s.append("caption",e);const a=Date.now()+Math.random(),h=URL.createObjectURL(o);j.value.push({id:a,text:h,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"image",metadata:e?{caption:e}:null});try{await v.post(route("chat.sendImage",d.value.id),s,{headers:{"Content-Type":"multipart/form-data"}})}catch(T){console.error("Failed to send image",T)}},_t=async o=>{const e=new FormData;e.append("document",o),e.append("filename",o.name);const s=Date.now()+Math.random();j.value.push({id:s,text:o.name,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"document"});try{await v.post(route("chat.sendDocument",d.value.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(a){console.error("Failed to send document",a)}},Ct=async()=>{try{const o=await navigator.mediaDevices.getUserMedia({audio:!0});let e={};MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?e={mimeType:"audio/webm;codecs=opus"}:MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")?e={mimeType:"audio/ogg;codecs=opus"}:MediaRecorder.isTypeSupported("audio/mp4")?e={mimeType:"audio/mp4"}:console.warn("Using default MediaRecorder mimeType"),x.value=new MediaRecorder(o,e),K.value=[],x.value.ondataavailable=s=>{K.value.push(s.data)},x.value.onstop=()=>{o.getTracks().forEach(s=>s.stop())},x.value.start(200),D.value=!0,W.value=0,ge.value=setInterval(()=>{W.value++},1e3)}catch(o){console.error("Error accessing microphone",o),alert("No se pudo acceder al micrÃ³fono")}},Mt=()=>{x.value&&(x.value.onstop=async()=>{const o=x.value.mimeType,e=new Blob(K.value,{type:o}),s=await Dt(e);await It(s),D.value=!1,clearInterval(ge.value),W.value=0,K.value=[]},x.value.stop())},jt=()=>{x.value&&D.value&&(x.value.stop(),D.value=!1,clearInterval(ge.value),W.value=0,K.value=[],x.value.stream&&x.value.stream.getTracks().forEach(o=>o.stop()))},Dt=async o=>{try{window.lamejs||await new Promise((k,$)=>{const B=document.createElement("script");B.src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.min.js",B.onload=k,B.onerror=$,document.head.appendChild(B)});const e=await o.arrayBuffer(),s=new AudioContext,a=await s.decodeAudioData(e),h=1,T=a.sampleRate,g=new window.lamejs.Mp3Encoder(h,T,128),re=a.getChannelData(0),ke=new Int16Array(re.length);for(let k=0;k<re.length;k++){const $=Math.max(-1,Math.min(1,re[k]));ke[k]=$<0?$*32768:$*32767}const _e=[],Ne=1152;for(let k=0;k<ke.length;k+=Ne){const $=ke.subarray(k,k+Ne),B=g.encodeBuffer($);B.length>0&&_e.push(B)}const Pe=g.flush();Pe.length>0&&_e.push(Pe),await s.close();const zt=new Blob(_e,{type:"audio/mpeg"});return new File([zt],"voice_note.mp3",{type:"audio/mpeg"})}catch(e){return console.error("MP3 conversion failed:",e),new File([o],"voice_note.ogg",{type:"audio/ogg"})}},Tt=o=>{const e=Math.floor(o/60),s=o%60;return`${e}:${s.toString().padStart(2,"0")}`},It=async o=>{const e=new FormData;e.append("audio",o);const s=Date.now()+Math.random(),a=URL.createObjectURL(o);j.value.push({id:s,text:a,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"audio"});try{await v.post(route("chat.sendAudio",d.value.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(h){console.error("Failed to send audio",h),alert("Error al enviar audio")}},Lt=o=>{const e=Array.from(o.target.files);!e.length||!d.value||(ye(e),o.target.value="")},$t=o=>{const e=Array.from(o.target.files);!e.length||!d.value||(ye(e),o.target.value="")},ye=o=>{c.value=o.map(e=>({file:e,name:e.name,type:e.type,isImage:e.type.startsWith("image/"),preview:e.type.startsWith("image/")?URL.createObjectURL(e):null,size:(e.size/1024).toFixed(1)+" KB"})),M.value=0,V.value="",le.value=!0},Ve=()=>{c.value.forEach(o=>{o.preview&&URL.revokeObjectURL(o.preview)}),c.value=[],V.value="",le.value=!1},Bt=o=>{c.value[o].preview&&URL.revokeObjectURL(c.value[o].preview),c.value.splice(o,1),c.value.length===0?Ve():M.value>=c.value.length&&(M.value=c.value.length-1)},Ae=async()=>{if(!c.value.length||!d.value)return;le.value=!1,A.value=!0;const o=V.value;for(const e of c.value)e.isImage?await kt(e.file,o):await _t(e.file);c.value.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)}),c.value=[],V.value="",A.value=!1},Rt=o=>{o.preventDefault(),Y.value=!0},Ut=()=>{Y.value=!1},Et=o=>{if(o.preventDefault(),Y.value=!1,!d.value)return;const e=Array.from(o.dataTransfer.files);e.length&&ye(e)};return Vt(()=>{Re(),Ue(),ht(),he=setInterval(()=>{ne(),Ue(),d.value&&Be()},5e3)}),At(()=>{he&&clearInterval(he)}),(o,e)=>(n(),l(p,null,[Ce(Me(Nt),{title:"Chat WhatsApp"}),t("div",Ot,[t("div",Ht,[t("div",Wt,[t("div",Kt,[t("span",qt,i(Ze.value?.name?.charAt(0)||"C"),1)])]),t("nav",Zt,[Ce(Me(Oe),{href:o.route("tenant.dashboard"),class:"flex items-center justify-center p-3 mx-2 rounded-xl text-slate-400 hover:bg-white/10 hover:text-white transition-colors",title:"Dashboard"},{default:Se(()=>[...e[27]||(e[27]=[t("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)])]),_:1},8,["href"]),e[28]||(e[28]=t("div",{class:"flex items-center justify-center p-3 mx-2 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg"},[t("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1))]),t("div",Qt,[t("button",{onClick:e[0]||(e[0]=s=>P.value=!P.value),class:"relative w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center mx-auto"},[t("span",Gt,i(De.value?.name?.charAt(0)||"U"),1)]),P.value?(n(),l("div",Jt,[Ce(Me(Oe),{href:o.route("tenant.settings"),class:"flex items-center gap-2 px-4 py-2.5 text-sm text-slate-300 hover:bg-white/10"},{default:Se(()=>[...e[29]||(e[29]=[Z(" ConfiguraciÃ³n",-1)])]),_:1},8,["href"]),t("button",{onClick:Qe,class:"flex w-full items-center gap-2 px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10"},"Cerrar SesiÃ³n")])):u("",!0)])]),t("div",Yt,[t("div",Xt,[t("div",es,[t("div",ts,[e[30]||(e[30]=t("h2",{class:"text-white font-semibold text-lg"},"Conversaciones",-1)),Ie.value>0?(n(),l("span",ss,i(Ie.value),1)):u("",!0)]),t("button",{onClick:e[1]||(e[1]=s=>S.value=!0),class:"p-2 bg-indigo-500/20 hover:bg-indigo-500/30 rounded-lg text-indigo-400 transition-colors",title:"Nuevo Chat"},[...e[31]||(e[31]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])]),t("div",os,[e[32]||(e[32]=t("svg",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>J.value=s),type:"text",placeholder:"Buscar chat...",class:"w-full pl-10 pr-4 py-2.5 rounded-xl bg-slate-700/50 border border-white/10 text-white text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},null,512),[[R,J.value]])])]),t("div",ls,[t("button",{onClick:e[3]||(e[3]=s=>ae("all")),class:m([U.value==="all"?"bg-indigo-500 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700","px-3 py-1.5 rounded-lg text-xs font-medium transition-colors"])}," Todos ",2),t("button",{onClick:e[4]||(e[4]=s=>ae("general")),class:m([U.value==="general"?"bg-indigo-500 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700","px-3 py-1.5 rounded-lg text-xs font-medium transition-colors"])}," General ",2),t("button",{onClick:e[5]||(e[5]=s=>ae("mine")),class:m([U.value==="mine"?"bg-indigo-500 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700","px-3 py-1.5 rounded-lg text-xs font-medium transition-colors"])}," Mis Chats ",2),Ye.value?(n(),l("select",{key:0,onChange:e[6]||(e[6]=s=>ae("user:"+s.target.value)),class:"ml-auto px-2 py-1.5 rounded-lg bg-slate-700/50 text-slate-300 text-xs border border-white/10"},[e[33]||(e[33]=t("option",{value:""},"Por Usuario",-1)),(n(!0),l(p,null,b(X.value,s=>(n(),l("option",{key:s.id,value:s.id},i(s.name),9,ns))),128))],32)):u("",!0),I.value.length>0?(n(),l("button",{key:1,onClick:e[7]||(e[7]=s=>ce.value=!0),class:"relative p-1.5 rounded-lg bg-amber-500/20 text-amber-400 hover:bg-amber-500/30 transition-colors"},[e[34]||(e[34]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),t("span",as,i(I.value.length),1)])):u("",!0)]),t("div",rs,[$e.value.length===0?(n(),l("div",is,[...e[35]||(e[35]=[t("svg",{class:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),t("p",{class:"text-sm"},"No hay conversaciones",-1)])])):u("",!0),(n(!0),l(p,null,b($e.value,s=>(n(),l("div",{key:s.id,onClick:a=>me(s),class:m(["flex items-center p-4 cursor-pointer border-b border-white/5 transition-all duration-200 hover:bg-white/5",{"bg-indigo-500/20 border-l-4 border-l-indigo-500":d.value&&d.value.id===s.id}])},[t("div",{class:m([ze(s.name),"w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-sm shadow-md"])},i(Ee(s.name)),3),t("div",us,[t("div",cs,[t("h3",ps,i(s.name),1),t("span",vs,i(s.relativeDate||s.formattedTime),1)]),t("p",gs,i(s.lastMessage||"Sin mensajes"),1)]),s.unread>0?(n(),l("div",hs,i(s.unread),1)):u("",!0)],10,ds))),128))])]),t("div",{class:"flex-1 flex flex-col bg-slate-900/50 min-h-0 relative",onDragover:Rt,onDragleave:Ut,onDrop:Et},[d.value?(n(),l("div",fs,[t("div",ms,[t("div",xs,[t("div",{class:m([ze(d.value.name),"w-11 h-11 rounded-full flex items-center justify-center text-white font-semibold shadow-md"])},i(Ee(d.value.name)),3),t("div",bs,[t("h3",ws,i(d.value.name),1),d.value.assigned_user?(n(),l("p",ys," Asignado a: "+i(d.value.assigned_user),1)):(n(),l("p",ks,"Pool General"))])]),d.value.assigned_to?(n(),l("button",{key:0,onClick:dt,class:"px-3 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-lg text-sm font-medium transition-colors flex items-center gap-1",title:"Transferir chat"},[...e[36]||(e[36]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1),Z(" Transferir ",-1)])])):u("",!0)]),t("div",{ref_key:"messageContainer",ref:G,class:"flex-1 overflow-y-auto px-6 py-4 min-h-0"},[(n(!0),l(p,null,b(rt.value,s=>(n(),l(p,{key:s.key||s.id},[s.type==="separator"?(n(),l("div",_s,[t("span",Cs,i(s.date),1)])):(n(),l("div",{key:1,class:m(["flex mb-2",s.sender==="me"?"justify-end":"justify-start"])},[t("div",{class:m(["max-w-[70%] px-3 py-2 rounded-xl shadow-sm relative",s.sender==="me"?"bg-indigo-600 rounded-br-sm":"bg-slate-700 rounded-bl-sm"])},[s.msgType==="image"?(n(),l(p,{key:0},[t("img",{src:s.text,alt:"Imagen",class:"max-w-[280px] max-h-[300px] rounded-lg cursor-pointer hover:opacity-90 object-cover",onClick:a=>xt(s.text)},null,8,Ms),s.metadata?.caption?(n(),l("p",js,i(s.metadata.caption),1)):u("",!0)],64)):s.msgType==="document"?(n(),l(p,{key:1},[t("div",Ds,[t("div",{class:m(["flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center",bt(s)])},[t("span",Ts,i(wt(s)),1)],2),t("div",Is,[t("p",Ls,i(be(s)),1),t("p",$s,i(we(s)),1)])]),t("div",Bs,[t("button",{onClick:a=>yt(s),class:"text-indigo-300 hover:text-indigo-200 font-medium"},"Abrir",8,Rs),t("a",{href:Fe(s),download:be(s),class:"text-indigo-300 hover:text-indigo-200 font-medium"},"Descargar",8,Us)])],64)):s.msgType==="audio"?(n(),l("div",Es,[t("audio",zs,[t("source",{src:s.text.startsWith("http")||s.text.startsWith("blob:")?s.text:`/storage/${s.text.replace("public/","")}`,type:"audio/mpeg"},null,8,Fs),t("source",{src:s.text.startsWith("http")||s.text.startsWith("blob:")?s.text:`/storage/${s.text.replace("public/","")}`,type:"audio/ogg"},null,8,Vs),t("source",{src:s.text.startsWith("http")||s.text.startsWith("blob:")?s.text:`/storage/${s.text.replace("public/","")}`,type:"audio/webm"},null,8,As),e[37]||(e[37]=Z(" Tu navegador no soporta audio. ",-1))])])):(n(),l("div",{key:3,class:"text-sm text-white break-words leading-relaxed",innerHTML:at(s.text)},null,8,Ns)),t("div",Ps,[t("span",Ss,i(s.time),1),s.sender==="me"?(n(),l("svg",Os,[...e[38]||(e[38]=[t("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"},null,-1)])])):u("",!0)])],2)],2))],64))),128))],512),Y.value?(n(),l("div",Hs,[...e[39]||(e[39]=[t("div",{class:"text-center"},[t("svg",{class:"w-16 h-16 mx-auto text-indigo-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),t("p",{class:"text-lg font-semibold text-indigo-300"},"Suelta tus archivos aquÃ­")],-1)])])):u("",!0),t("div",Ws,[t("input",{type:"file",ref_key:"imageInput",ref:Ge,accept:"image/*",multiple:"",class:"hidden",onChange:Lt},null,544),t("input",{type:"file",ref_key:"documentInput",ref:Je,multiple:"",class:"hidden",onChange:$t},null,544),t("button",{onClick:e[8]||(e[8]=s=>o.$refs.imageInput.click()),class:"p-2 rounded-lg hover:bg-white/10 text-slate-400 transition-colors",title:"Enviar imagen"},[...e[40]||(e[40]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]),t("button",{onClick:e[9]||(e[9]=s=>o.$refs.documentInput.click()),class:"p-2 rounded-lg hover:bg-white/10 text-slate-400 transition-colors",title:"Enviar documento"},[...e[41]||(e[41]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])]),t("div",Ks,[t("button",{onClick:e[10]||(e[10]=s=>L.value=!L.value),class:m(["p-2 rounded-lg transition-colors",L.value?"bg-indigo-600 text-white":"hover:bg-white/10 text-yellow-400"]),title:"Respuestas RÃ¡pidas"},[...e[42]||(e[42]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)])],2),L.value?(n(),l("div",qs,[t("div",Zs,[e[44]||(e[44]=t("span",{class:"font-medium text-white"},"âš¡ Respuestas RÃ¡pidas",-1)),t("button",{onClick:e[11]||(e[11]=s=>L.value=!1),class:"text-slate-400 hover:text-white"},[...e[43]||(e[43]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),z.value.length===0?(n(),l("div",Qs,[e[45]||(e[45]=t("p",{class:"mb-2"},"Sin respuestas configuradas",-1)),t("a",{href:o.route("quick-replies.manage"),class:"text-indigo-400 hover:text-indigo-300 text-sm"}," Configurar respuestas â†’ ",8,Gs)])):(n(),l(p,{key:1},[t("div",Js,[(n(!0),l(p,null,b(z.value,s=>(n(),l("button",{key:s.id,onClick:a=>se.value=s.id,class:m(["px-3 py-1.5 rounded-lg text-sm whitespace-nowrap transition-colors",se.value===s.id?"bg-indigo-600 text-white":"text-slate-300 hover:bg-white/10"])},i(s.icon)+" "+i(s.name),11,Ys))),128))]),t("div",Xs,[(n(!0),l(p,null,b(z.value,s=>(n(),l(p,{key:"replies-"+s.id},[se.value===s.id?(n(),l("div",eo,[(n(!0),l(p,null,b(s.replies,a=>(n(),l("div",{key:a.id,class:"px-4 py-3 hover:bg-white/5 cursor-pointer border-b border-white/5 group",onClick:h=>ft(a)},[t("div",so,[t("span",oo,i(a.title),1),t("button",{onClick:Ke(h=>mt(a),["stop"]),class:"opacity-0 group-hover:opacity-100 p-1 bg-indigo-600 hover:bg-indigo-700 rounded text-white transition-all",title:"Enviar directamente"},[...e[46]||(e[46]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,lo)]),t("p",no,i(a.body),1),a.image_url?(n(),l("div",ao,[t("img",{src:a.image_url,class:"h-10 rounded object-cover",alt:"Preview"},null,8,ro)])):u("",!0)],8,to))),128)),s.replies?.length?u("",!0):(n(),l("div",io," Sin respuestas en esta categorÃ­a "))])):u("",!0)],64))),128))])],64))])):u("",!0)]),D.value?(n(),l("div",uo,[t("div",co,[e[47]||(e[47]=t("span",{class:"relative flex h-3 w-3"},[t("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),t("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})],-1)),t("span",po,i(Tt(W.value)),1)]),e[48]||(e[48]=t("span",{class:"text-slate-400 text-xs"},"Grabando audio...",-1))])):_((n(),l("textarea",{key:0,"onUpdate:modelValue":e[12]||(e[12]=s=>y.value=s),onKeydown:pt,onPaste:gt,ref_key:"messageInput",ref:f,placeholder:"Escribe un mensaje (Shift+Enter para nueva lÃ­nea)",rows:"1",class:"flex-1 px-5 py-3 rounded-xl bg-slate-700/50 border border-white/10 text-white text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none max-h-24 sm:max-h-32 lg:max-h-64 overflow-y-auto leading-relaxed"},null,544)),[[R,y.value]]),y.value.trim()?(n(),l("button",{key:2,onClick:xe,disabled:A.value,class:"p-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-lg"},[...e[49]||(e[49]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,vo)):(n(),l("div",go,[D.value?(n(),l("button",{key:0,onClick:jt,class:"p-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors shadow-lg",title:"Cancelar"},[...e[50]||(e[50]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):u("",!0),t("button",{onClick:e[13]||(e[13]=s=>D.value?Mt():Ct()),class:m(["p-3 text-white rounded-xl transition-colors shadow-lg",D.value?"bg-green-500 hover:bg-green-600":"bg-slate-700 hover:bg-slate-600"])},[D.value?(n(),l("svg",fo,[...e[52]||(e[52]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(n(),l("svg",ho,[...e[51]||(e[51]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},null,-1)])]))],2)]))])])):(n(),l("div",mo,[...e[53]||(e[53]=[He('<div class="w-24 h-24 bg-slate-700/50 rounded-full flex items-center justify-center mb-4" data-v-be0c66ae><svg class="w-12 h-12 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-be0c66ae><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-be0c66ae></path></svg></div><h3 class="text-xl font-medium text-white mb-2" data-v-be0c66ae>Chat WhatsApp</h3><p class="text-sm" data-v-be0c66ae>Selecciona un chat para comenzar</p>',3)])]))],32),d.value&&Xe.value?(n(),l("div",xo,[t("div",{class:"p-4 border-b border-white/10 flex justify-between items-center"},[e[54]||(e[54]=t("h3",{class:"text-white font-semibold"},"CRM Contacto",-1)),t("button",{onClick:tt,class:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium rounded-lg transition-colors"}," Guardar ")]),pe.value?(n(),l("div",bo,[...e[55]||(e[55]=[t("svg",{class:"animate-spin h-5 w-5 mr-2 text-white",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),Z(" Cargando... ",-1)])])):(n(),l("div",wo,[t("div",yo,[e[56]||(e[56]=t("p",{class:"text-xs text-slate-500 uppercase font-bold mb-2"},"Contacto",-1)),t("p",ko,i(d.value.name),1),t("p",_o,i(d.value.wa_id),1),t("p",Co,i(d.value.email||"Sin email"),1)]),t("div",Mo,[t("div",null,[e[58]||(e[58]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Nivel de InterÃ©s",-1)),_(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>w.value.nivel_interes=s),class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none"},[...e[57]||(e[57]=[t("option",{value:""},"-- Seleccionar --",-1),t("option",{value:"frio"},"â„ï¸ FrÃ­o",-1),t("option",{value:"tibio"},"ðŸ”¥ Tibio",-1),t("option",{value:"caliente"},"ðŸ’¥ Caliente",-1)])],512),[[ue,w.value.nivel_interes]])]),t("div",null,[e[60]||(e[60]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Estado CRM",-1)),_(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>w.value.estado_crm=s),class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none"},[...e[59]||(e[59]=[He('<option value="" data-v-be0c66ae>-- Seleccionar --</option><option value="prospecto" data-v-be0c66ae>Prospecto</option><option value="interesado" data-v-be0c66ae>Interesado</option><option value="inscrito" data-v-be0c66ae>Inscrito</option><option value="perdido" data-v-be0c66ae>Perdido</option>',5)])],512),[[ue,w.value.estado_crm]])])]),t("div",null,[e[61]||(e[61]=t("label",{class:"block text-xs font-medium text-slate-400 mb-2"},"Carreras de InterÃ©s",-1)),t("div",jo,[(n(!0),l(p,null,b(Q.catalogs.carreras,s=>(n(),l("label",{key:s.id,class:"flex items-start gap-2 p-2 rounded hover:bg-white/5 cursor-pointer text-sm"},[t("input",{type:"checkbox",checked:w.value.carreras.includes(s.id),onChange:a=>Te("carreras",s.id),class:"mt-1 rounded bg-slate-700 border-slate-500 text-indigo-600 focus:ring-indigo-500"},null,40,Do),t("div",null,[t("span",To,i(s.nombre),1),s.duracion?(n(),l("span",Io,i(s.duracion),1)):u("",!0)])]))),128)),Q.catalogs.carreras?.length?u("",!0):(n(),l("p",Lo,"No hay carreras disponibles"))])]),t("div",null,[e[62]||(e[62]=t("label",{class:"block text-xs font-medium text-slate-400 mb-2"},"Sedes Preferidas",-1)),t("div",$o,[(n(!0),l(p,null,b(Q.catalogs.sedes,s=>(n(),l("label",{key:s.id,class:"flex items-center gap-2 p-2 rounded hover:bg-white/5 cursor-pointer text-sm"},[t("input",{type:"checkbox",checked:w.value.sedes.includes(s.id),onChange:a=>Te("sedes",s.id),class:"rounded bg-slate-700 border-slate-500 text-indigo-600 focus:ring-indigo-500"},null,40,Bo),t("span",Ro,i(s.nombre),1)]))),128))])]),t("div",null,[e[63]||(e[63]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Notas / Observaciones",-1)),_(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=s=>w.value.notas_crm=s),rows:"4",class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none placeholder-slate-600",placeholder:"Escribe notas aquÃ­..."},null,512),[[R,w.value.notas_crm]])]),e[64]||(e[64]=t("div",{class:"h-10"},null,-1))]))])):u("",!0),P.value?(n(),l("div",{key:1,onClick:e[17]||(e[17]=s=>P.value=!1),class:"fixed inset-0 z-40"})):u("",!0)]),le.value?(n(),l("div",Uo,[t("div",Eo,[t("div",zo,[t("div",Fo,[t("button",{onClick:Ve,class:"p-2 hover:bg-white/10 rounded-full transition-colors"},[...e[65]||(e[65]=[t("svg",{class:"w-5 h-5 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),t("span",Vo,i(c.value.length)+" archivo"+i(c.value.length>1?"s":""),1)])]),t("div",Ao,[c.value[M.value]?(n(),l("div",No,[c.value[M.value].isImage?(n(),l("img",{key:0,src:c.value[M.value].preview,class:"max-w-full max-h-[300px] rounded-lg object-contain"},null,8,Po)):(n(),l("div",So,[e[66]||(e[66]=t("svg",{class:"w-20 h-20 mx-auto text-slate-500 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t("p",Oo,i(c.value[M.value].name),1),t("p",Ho,i(c.value[M.value].size),1)]))])):u("",!0),c.value.length>1?(n(),l("div",Wo,[(n(!0),l(p,null,b(c.value,(s,a)=>(n(),l("div",{key:a,class:m(["relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all",M.value===a?"border-indigo-500":"border-transparent"]),onClick:h=>M.value=a},[s.isImage?(n(),l("img",{key:0,src:s.preview,class:"w-16 h-16 object-cover"},null,8,qo)):(n(),l("div",Zo,[...e[67]||(e[67]=[t("svg",{class:"w-8 h-8 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])])),t("button",{onClick:Ke(h=>Bt(a),["stop"]),class:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center shadow-lg"},[...e[68]||(e[68]=[t("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Qo)],10,Ko))),128))])):u("",!0)]),t("div",Go,[t("div",Jo,[_(t("input",{"onUpdate:modelValue":e[18]||(e[18]=s=>V.value=s),type:"text",placeholder:"Agregar un comentario...",class:"flex-1 bg-slate-700/50 text-white px-4 py-3 rounded-xl border border-white/10 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 placeholder-slate-400",onKeyup:We(Ae,["enter"])},null,544),[[R,V.value]]),t("button",{onClick:Ae,disabled:A.value,class:"p-3 bg-indigo-500 hover:bg-indigo-600 rounded-xl transition-colors disabled:opacity-50"},[...e[69]||(e[69]=[t("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,Yo)])])])])):u("",!0),S.value?(n(),l("div",Xo,[t("div",el,[t("div",tl,[e[71]||(e[71]=t("h3",{class:"text-white font-semibold text-lg"},"Iniciar ConversaciÃ³n",-1)),t("button",{onClick:e[19]||(e[19]=s=>S.value=!1),class:"text-white/80 hover:text-white transition-colors"},[...e[70]||(e[70]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",sl,[t("div",null,[e[73]||(e[73]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Prefijo PaÃ­s",-1)),t("div",ol,[e[72]||(e[72]=t("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium"},"+",-1)),_(t("input",{"onUpdate:modelValue":e[20]||(e[20]=s=>ve.value=s),type:"text",class:"w-full pl-6 pr-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none",placeholder:"591"},null,512),[[R,ve.value]])])]),t("div",null,[e[74]||(e[74]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"NÃºmero de TelÃ©fono",-1)),_(t("input",{"onUpdate:modelValue":e[21]||(e[21]=s=>F.value=s),type:"tel",class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none",placeholder:"70012345",onKeyup:We(Le,["enter"])},null,544),[[R,F.value]])]),t("div",null,[e[76]||(e[76]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Plantilla de Inicio (Opcional)",-1)),_(t("select",{"onUpdate:modelValue":e[22]||(e[22]=s=>oe.value=s),class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none text-sm"},[e[75]||(e[75]=t("option",{value:""},"-- Ninguna --",-1)),(n(!0),l(p,null,b(O.value,s=>(n(),l("option",{key:s.name,value:s.name},i(s.name)+" ("+i(s.language)+") ",9,ll))),128))],512),[[ue,oe.value]]),e[77]||(e[77]=t("p",{class:"text-xs text-slate-400 mt-1"},"Si el contacto no te ha escrito en 24h, usa una plantilla. ",-1))]),t("button",{onClick:Le,disabled:H.value||!F.value,class:"w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[H.value?(n(),l("span",al)):u("",!0),Z(" "+i(H.value?"Iniciando...":"Iniciar Chat"),1)],8,nl)])])])):u("",!0),ee.value?(n(),l("div",rl,[t("div",il,[e[81]||(e[81]=t("h3",{class:"text-xl font-bold text-white mb-4"},"Transferir Chat",-1)),t("p",dl,'Transferir "'+i(d.value?.name)+'" a otro usuario',1),t("div",ul,[t("div",null,[e[79]||(e[79]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Usuario Destino",-1)),_(t("select",{"onUpdate:modelValue":e[23]||(e[23]=s=>E.value=s),class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 outline-none"},[e[78]||(e[78]=t("option",{value:null},"Seleccionar usuario...",-1)),(n(!0),l(p,null,b(X.value,s=>(n(),l("option",{key:s.id,value:s.id},i(s.name)+" "+i(s.apellidos||""),9,cl))),128))],512),[[ue,E.value]])]),t("div",null,[e[80]||(e[80]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Nota (opcional)",-1)),_(t("textarea",{"onUpdate:modelValue":e[24]||(e[24]=s=>te.value=s),rows:"2",placeholder:"Motivo de la transferencia...",class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm resize-none"},null,512),[[R,te.value]])]),t("div",pl,[t("button",{onClick:e[25]||(e[25]=s=>ee.value=!1),class:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors"}," Cancelar "),t("button",{onClick:ut,disabled:!E.value,class:"flex-1 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Transferir ",8,vl)])])])])):u("",!0),ce.value?(n(),l("div",gl,[t("div",hl,[t("div",fl,[e[83]||(e[83]=t("h3",{class:"text-xl font-bold text-white"},"Chats Transferidos",-1)),t("button",{onClick:e[26]||(e[26]=s=>ce.value=!1),class:"text-slate-400 hover:text-white"},[...e[82]||(e[82]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),I.value.length===0?(n(),l("div",ml," No tienes transferencias pendientes ")):(n(),l("div",xl,[(n(!0),l(p,null,b(I.value,s=>(n(),l("div",{key:s.id,class:"p-4 bg-slate-700/50 rounded-lg border border-white/10"},[t("div",bl,[t("div",null,[t("p",wl,i(s.contact?.name),1),t("p",yl,"De: "+i(s.from_user?.name),1),s.notes?(n(),l("p",kl,'"'+i(s.notes)+'"',1)):u("",!0)]),t("button",{onClick:a=>ct(s),class:"px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white text-xs rounded-lg transition-colors"}," Aceptar ",8,_l)])]))),128))]))])])):u("",!0)],64))}},Dl=St(Cl,[["__scopeId","data-v-be0c66ae"]]);export{Dl as default};

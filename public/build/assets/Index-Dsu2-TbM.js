import{m as d,j as z,p as ee,q as te,s as se,g as a,a as N,d as oe,h as re,w as ae,b as t,i as g,k as V,x as $,o as l,F as h,y as A,n as f,t as n,z as le,A as ne,B as p}from"./app-CnCbzOY4.js";import{_ as ie}from"./AuthenticatedLayout-DhMaFrAE.js";import"./ApplicationLogo-Df4GGQfj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"flex h-[calc(100vh-65px)] bg-gray-50 overflow-hidden"},ue={class:"w-80 bg-white border-r border-gray-200 flex flex-col shadow-sm"},ce={class:"p-4 bg-gradient-to-r from-emerald-600 to-teal-600"},me={class:"relative"},ge={class:"flex-1 overflow-y-auto"},fe={key:0,class:"p-6 text-center text-gray-400"},pe=["onClick"],ve={class:"ml-3 flex-1 min-w-0"},he={class:"flex justify-between items-center mb-1"},xe={class:"font-semibold text-gray-800 truncate"},ye={class:"text-xs text-gray-400 whitespace-nowrap ml-2"},we={class:"text-sm text-gray-500 truncate"},be={key:0,class:"ml-2 bg-emerald-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center"},ke={key:0,class:"flex-1 flex flex-col min-h-0"},Ce={class:"px-5 py-3 bg-white border-b border-gray-200 flex items-center justify-between shrink-0 shadow-sm"},De={class:"flex items-center"},Me={class:"ml-3"},_e={class:"font-semibold text-gray-800"},je={key:0,class:"flex justify-center my-4"},Ie={class:"bg-white/90 text-gray-600 text-xs font-medium px-4 py-1.5 rounded-full shadow-sm"},Te=["src","onClick"],Be={key:0,class:"text-[15px] text-gray-800 mt-2"},Ee={key:1,class:"text-[15px] text-gray-800 break-words"},Le={class:"flex items-center justify-end gap-1 mt-1"},ze={class:"text-[11px] text-gray-500"},Ne={key:0,class:"w-4 h-4 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24"},Ve={key:0,class:"absolute inset-0 bg-emerald-500/20 border-4 border-dashed border-emerald-500 rounded-lg flex items-center justify-center z-50"},$e={class:"px-4 py-3 bg-gray-100 border-t border-gray-200 flex items-center gap-3"},Ae=["disabled"],Fe={key:1,class:"flex-1 flex flex-col items-center justify-center text-gray-400"},Oe={key:0,class:"w-80 bg-white border-l border-gray-200 flex flex-col hidden lg:flex shadow-sm"},He={class:"flex-1 p-5 space-y-5 overflow-y-auto"},Ue={class:"bg-gray-50 rounded-xl p-4 text-center"},Re={class:"mt-3 font-semibold text-gray-800"},Ze={class:"text-sm text-gray-500"},Ke=["value"],Ge={__name:"Index",props:{initialContacts:Array},setup(F){const v=d(F.initialContacts),r=d(null),c=d([]),x=d(null),y=d(""),O=d(null),H=d(null),w=d(!1);let k=null;const U=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],R=["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],j=s=>{if(!s)return"";let e;if(s.includes("T")&&(s.includes("+")||s.includes("Z"))?e=new Date(s):e=new Date(s.replace(" ","T")+"Z"),isNaN(e.getTime()))return s;const o=new Date,i=new Date(o.getFullYear(),o.getMonth(),o.getDate()),_=new Date(e.getFullYear(),e.getMonth(),e.getDate()),b=Math.floor((i-_)/(1e3*60*60*24));return b===0?"Hoy":b===1?"Ayer":b===2?"Anteayer":b<7?U[e.getDay()]:`${e.getDate()} ${R[e.getMonth()]}`},C=s=>{if(!s)return"";let e;return s.includes("T")&&(s.includes("+")||s.includes("Z"))?e=new Date(s):e=new Date(s.replace(" ","T")+"Z"),isNaN(e.getTime())?s:e.toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"})},Z=s=>{if(!s)return"";let e;return s.includes("T")&&(s.includes("+")||s.includes("Z"))?e=new Date(s):e=new Date(s.replace(" ","T")+"Z"),`${e.getFullYear()}-${e.getMonth()}-${e.getDate()}`},I=z(()=>{if(!y.value.trim())return v.value;const s=y.value.toLowerCase();return v.value.filter(e=>e.name&&e.name.toLowerCase().includes(s)||e.lastMessage&&e.lastMessage.toLowerCase().includes(s))}),K=z(()=>{const s=[];let e=null;return c.value.forEach(o=>{const i=Z(o.rawDate);i!==e&&(s.push({type:"separator",date:j(o.rawDate),key:"sep-"+i}),e=i),s.push({type:"message",...o})}),s}),S=async()=>{await ne(),setTimeout(()=>{x.value&&(x.value.scrollTop=x.value.scrollHeight)},100)};ee(c,()=>{S()},{deep:!0});const q=async s=>{if(r.value=s,c.value=[],await T(),s.unread>0)try{await p.post(route("chat.read",s.id));const e=v.value.findIndex(o=>o.id===s.id);e!==-1&&(v.value[e].unread=0)}catch(e){console.error("Error marking as read",e)}},T=async()=>{if(r.value)try{const e=(await p.get(route("chat.messages",r.value.id))).data.map(o=>({id:o.id,text:o.body,sender:o.direction==="outgoing"?"me":"them",time:C(o.created_at),rawDate:o.created_at,msgType:o.type,metadata:o.metadata?JSON.parse(o.metadata):null}));e.length!==c.value.length&&(c.value=e)}catch(s){console.error("Error loading messages",s)}},Y=async()=>{try{const s=await p.get(route("chat.contacts"));v.value=s.data.map(e=>({...e,relativeDate:j(e.time),formattedTime:C(e.time)}))}catch(s){console.error("Error fetching contacts",s)}},m=d(""),u=d(!1),B=async()=>{if(!m.value.trim()||!r.value)return;const s=m.value;m.value="",u.value=!0;const e=new Date().toISOString(),o=Date.now();c.value.push({id:o,text:s,sender:"me",time:C(e),rawDate:e});try{await p.post(route("chat.send",r.value.id),{message:s})}catch(i){console.error("Failed to send",i),alert("Error al enviar mensaje")}finally{u.value=!1}},D=s=>{if(!s)return"?";const e=s.split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():s.substring(0,2).toUpperCase()},M=s=>{if(!s)return"bg-gray-400";const e=["bg-emerald-500","bg-blue-500","bg-purple-500","bg-pink-500","bg-orange-500","bg-teal-500","bg-indigo-500","bg-rose-500"],o=s.charCodeAt(0)%e.length;return e[o]},J=s=>{window.open(s,"_blank")},E=async s=>{const e=new FormData;e.append("image",s);const o=Date.now()+Math.random(),i=URL.createObjectURL(s);c.value.push({id:o,text:i,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"image"});try{await p.post(route("chat.sendImage",r.value.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(_){console.error("Failed to send image",_)}},L=async s=>{const e=new FormData;e.append("document",s),e.append("filename",s.name);const o=Date.now()+Math.random();c.value.push({id:o,text:s.name,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"document"});try{await p.post(route("chat.sendDocument",r.value.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(i){console.error("Failed to send document",i)}},P=async s=>{const e=Array.from(s.target.files);if(!(!e.length||!r.value)){u.value=!0;for(const o of e)await E(o);u.value=!1,s.target.value=""}},G=async s=>{const e=Array.from(s.target.files);if(!(!e.length||!r.value)){u.value=!0;for(const o of e)await L(o);u.value=!1,s.target.value=""}},Q=s=>{s.preventDefault(),w.value=!0},W=()=>{w.value=!1},X=async s=>{if(s.preventDefault(),w.value=!1,!r.value)return;const e=Array.from(s.dataTransfer.files);if(e.length){u.value=!0;for(const o of e)o.type.startsWith("image/")?await E(o):await L(o);u.value=!1}};return te(()=>{k=setInterval(()=>{Y(),r.value&&T()},5e3)}),se(()=>{k&&clearInterval(k)}),(s,e)=>(l(),a(h,null,[N(oe(re),{title:"Chat CRM"}),N(ie,null,{default:ae(()=>[t("div",de,[t("div",ue,[t("div",ce,[e[5]||(e[5]=t("h2",{class:"text-white font-semibold text-lg mb-3"},"Conversaciones",-1)),t("div",me,[e[4]||(e[4]=t("svg",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),V(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),type:"text",placeholder:"Buscar chat...",class:"w-full pl-10 pr-4 py-2.5 rounded-xl bg-white/90 border-0 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-white/50 focus:bg-white transition-all"},null,512),[[$,y.value]])])]),t("div",ge,[I.value.length===0?(l(),a("div",fe,[...e[6]||(e[6]=[t("svg",{class:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),t("p",{class:"text-sm"},"No hay conversaciones",-1)])])):g("",!0),(l(!0),a(h,null,A(I.value,o=>(l(),a("div",{key:o.id,onClick:i=>q(o),class:f(["flex items-center p-4 cursor-pointer border-b border-gray-100 transition-all duration-200 hover:bg-gray-50",{"bg-emerald-50 border-l-4 border-l-emerald-500":r.value&&r.value.id===o.id}])},[t("div",{class:f([M(o.name),"w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-sm shadow-md"])},n(D(o.name)),3),t("div",ve,[t("div",he,[t("h3",xe,n(o.name),1),t("span",ye,n(o.relativeDate||o.formattedTime),1)]),t("p",we,n(o.lastMessage||"Sin mensajes"),1)]),o.unread>0?(l(),a("div",be,n(o.unread),1)):g("",!0)],10,pe))),128))])]),t("div",{class:"flex-1 flex flex-col bg-[#efeae2] min-h-0 relative",onDragover:Q,onDragleave:W,onDrop:X,style:{"background-image":"url('data:image/svg+xml,%3Csvg width=\\'60\\' height=\\'60\\' viewBox=\\'0 0 60 60\\' xmlns=\\'http://www.w3.org/2000/svg\\'%3E%3Cg fill=\\'none\\' fill-rule=\\'evenodd\\'%3E%3Cg fill=\\'%23d5cfc7\\' fill-opacity=\\'0.3\\'%3E%3Cpath d=\\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')"}},[r.value?(l(),a("div",ke,[t("div",Ce,[t("div",De,[t("div",{class:f([M(r.value.name),"w-11 h-11 rounded-full flex items-center justify-center text-white font-semibold shadow-md"])},n(D(r.value.name)),3),t("div",Me,[t("h3",_e,n(r.value.name),1),e[7]||(e[7]=t("p",{class:"text-xs text-emerald-600"},"En línea",-1))])]),e[8]||(e[8]=t("div",{class:"flex items-center gap-2"},[t("button",{class:"p-2 rounded-full hover:bg-gray-100 text-gray-500 transition-colors"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])]),t("button",{class:"p-2 rounded-full hover:bg-gray-100 text-gray-500 transition-colors"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})])])],-1))]),t("div",{ref_key:"messageContainer",ref:x,class:"flex-1 overflow-y-auto px-6 py-4 min-h-0"},[(l(!0),a(h,null,A(K.value,o=>(l(),a(h,{key:o.key||o.id},[o.type==="separator"?(l(),a("div",je,[t("span",Ie,n(o.date),1)])):(l(),a("div",{key:1,class:f(["flex mb-2",o.sender==="me"?"justify-end":"justify-start"])},[t("div",{class:f(["max-w-[70%] px-3 py-2 rounded-lg shadow-sm relative",o.sender==="me"?"bg-[#d9fdd3] rounded-tr-none":"bg-white rounded-tl-none"])},[o.msgType==="image"?(l(),a(h,{key:0},[t("img",{src:o.text,alt:"Imagen",class:"max-w-[280px] max-h-[300px] rounded-lg cursor-pointer hover:opacity-90 object-cover",onClick:i=>J(o.text)},null,8,Te),o.metadata?.caption?(l(),a("p",Be,n(o.metadata.caption),1)):g("",!0)],64)):(l(),a("p",Ee,n(o.text),1)),t("div",Le,[t("span",ze,n(o.time),1),o.sender==="me"?(l(),a("svg",Ne,[...e[9]||(e[9]=[t("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"},null,-1)])])):g("",!0)])],2)],2))],64))),128))],512),w.value?(l(),a("div",Ve,[...e[10]||(e[10]=[t("div",{class:"text-center"},[t("svg",{class:"w-16 h-16 mx-auto text-emerald-600 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),t("p",{class:"text-lg font-semibold text-emerald-700"},"Suelta tus archivos aquí"),t("p",{class:"text-sm text-emerald-600"},"Imágenes o documentos")],-1)])])):g("",!0),t("div",$e,[t("input",{type:"file",ref_key:"imageInput",ref:O,accept:"image/*",multiple:"",class:"hidden",onChange:P},null,544),t("input",{type:"file",ref_key:"documentInput",ref:H,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",multiple:"",class:"hidden",onChange:G},null,544),t("button",{onClick:e[1]||(e[1]=o=>s.$refs.imageInput.click()),class:"p-2 rounded-full hover:bg-gray-200 text-gray-500 transition-colors",title:"Enviar imagen"},[...e[11]||(e[11]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]),t("button",{onClick:e[2]||(e[2]=o=>s.$refs.documentInput.click()),class:"p-2 rounded-full hover:bg-gray-200 text-gray-500 transition-colors",title:"Enviar documento"},[...e[12]||(e[12]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])]),V(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>m.value=o),onKeyup:le(B,["enter"]),type:"text",placeholder:"Escribe un mensaje",class:"flex-1 px-5 py-3 rounded-full bg-white border-0 text-[15px] focus:outline-none focus:ring-2 focus:ring-emerald-500 shadow-sm"},null,544),[[$,m.value]]),t("button",{onClick:B,disabled:u.value||!m.value.trim(),class:"p-3 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md"},[...e[13]||(e[13]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,Ae)])])):(l(),a("div",Fe,[...e[14]||(e[14]=[t("div",{class:"w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mb-4"},[t("svg",{class:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1),t("h3",{class:"text-xl font-medium text-gray-600 mb-2"},"UNITEPC CRM Chat",-1),t("p",{class:"text-sm"},"Selecciona un chat para comenzar",-1)])]))],32),r.value?(l(),a("div",Oe,[e[19]||(e[19]=t("div",{class:"p-5 bg-gradient-to-r from-gray-50 to-gray-100 border-b"},[t("h2",{class:"text-lg font-bold text-gray-800"},"Información del CRM")],-1)),t("div",He,[t("div",Ue,[t("div",{class:f([M(r.value.name),"w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-xl mx-auto shadow-lg"])},n(D(r.value.name)),3),t("h3",Re,n(r.value.name),1),t("p",Ze,"+591 "+n(r.value.wa_id?.slice(-8)||"--------"),1)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1.5"},"Nombre completo",-1)),t("input",{value:r.value.name,class:"w-full px-3 py-2.5 rounded-lg border border-gray-200 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"},null,8,Ke)]),e[16]||(e[16]=t("div",null,[t("label",{class:"block text-sm font-medium text-gray-600 mb-1.5"},"Carrera de Interés"),t("select",{class:"w-full px-3 py-2.5 rounded-lg border border-gray-200 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"},[t("option",null,"Medicina"),t("option",null,"Odontología"),t("option",null,"Ing. Sistemas"),t("option",null,"Derecho"),t("option",null,"Enfermería")])],-1)),e[17]||(e[17]=t("div",null,[t("label",{class:"block text-sm font-medium text-gray-600 mb-1.5"},"Estado"),t("div",{class:"flex gap-2 flex-wrap"},[t("span",{class:"px-3 py-1.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700 cursor-pointer hover:bg-yellow-200 transition-colors"}," Prospecto "),t("span",{class:"px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 cursor-pointer hover:bg-gray-200 transition-colors"}," Interesado "),t("span",{class:"px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 cursor-pointer hover:bg-gray-200 transition-colors"}," Inscrito ")])],-1)),e[18]||(e[18]=t("div",null,[t("label",{class:"block text-sm font-medium text-gray-600 mb-1.5"},"Notas"),t("textarea",{rows:"3",placeholder:"Agregar notas sobre el contacto...",class:"w-full px-3 py-2.5 rounded-lg border border-gray-200 bg-white text-sm resize-none focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"})],-1))]),e[20]||(e[20]=t("div",{class:"p-4 border-t"},[t("button",{class:"w-full py-2.5 bg-emerald-500 hover:bg-emerald-600 text-white font-medium rounded-lg transition-colors shadow-sm"}," Guardar cambios ")],-1))])):g("",!0)])]),_:1})],64))}};export{Ge as default};

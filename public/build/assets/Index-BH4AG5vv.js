import{e as Se,p as U,f as i,E as ve,G as h,B as Ke,H as Ze,c as l,a as J,b as t,d as c,u as Y,h as We,t as a,w as pe,l as fe,q as G,k as g,v as D,F as m,r as M,n as w,I as Q,y as he,x as X,J as qe,s as Je,o as n,j as Ye}from"./app-DexyC0dx.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Qe={class:"h-screen flex bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900"},Xe={class:"hidden lg:flex w-16 flex-col bg-slate-900/80 border-r border-white/10"},et={class:"h-16 flex items-center justify-center border-b border-white/10"},tt={class:"h-10 w-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center"},st={class:"text-lg font-bold text-white"},ot={class:"flex-1 py-4 space-y-2"},lt={class:"p-3 border-t border-white/10"},nt={class:"text-sm font-bold text-white"},at={key:0,class:"absolute bottom-16 left-2 w-48 rounded-lg bg-slate-800 border border-white/10 shadow-xl overflow-hidden z-50"},rt={class:"w-80 bg-slate-800/50 border-r border-white/10 flex flex-col backdrop-blur-xl"},it={class:"p-4 border-b border-white/10"},dt={class:"flex items-center justify-between mb-3"},ut={class:"flex items-center gap-2"},ct={key:0,class:"bg-indigo-500 text-white px-2 py-0.5 rounded-full text-xs font-bold"},vt={class:"relative"},pt={class:"flex-1 overflow-y-auto"},ft={key:0,class:"p-6 text-center text-slate-400"},ht=["onClick"],mt={class:"ml-3 flex-1 min-w-0"},gt={class:"flex justify-between items-center mb-1"},xt={class:"font-semibold text-white truncate"},bt={class:"text-xs text-slate-400 whitespace-nowrap ml-2"},wt={class:"text-sm text-slate-400 truncate"},yt={key:0,class:"ml-2 bg-indigo-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center"},kt={key:0,class:"flex-1 flex flex-col min-h-0"},Ct={class:"px-5 py-3 bg-slate-800/80 border-b border-white/10 flex items-center justify-between shrink-0 backdrop-blur-xl"},_t={class:"flex items-center"},Dt={class:"ml-3"},Mt={class:"font-semibold text-white"},jt={key:0,class:"flex justify-center my-4"},It={class:"bg-slate-700/80 text-slate-300 text-xs font-medium px-4 py-1.5 rounded-full"},Lt=["src","onClick"],Tt={key:0,class:"text-sm text-white mt-2"},Bt={class:"flex items-start gap-3 min-w-[220px] p-2 bg-slate-600/50 rounded-lg"},Ut={class:"text-white text-xs font-bold"},zt={class:"flex-1 min-w-0"},Vt={class:"text-sm font-medium text-white truncate"},Et={class:"text-xs text-slate-300 mt-0.5"},Nt={class:"flex gap-4 mt-2 text-sm"},$t=["onClick"],Ft=["href","download"],Pt={key:2,class:"text-sm text-white break-words"},At={class:"flex items-center justify-end gap-1 mt-1"},Ot={class:"text-[10px] text-white/60"},Rt={key:0,class:"w-4 h-4 text-white/60",fill:"currentColor",viewBox:"0 0 24 24"},Ht={key:0,class:"absolute inset-0 bg-indigo-500/20 border-4 border-dashed border-indigo-500 rounded-lg flex items-center justify-center z-50"},St={class:"px-4 py-3 bg-slate-800/80 border-t border-white/10 flex items-center gap-3 backdrop-blur-xl"},Kt=["disabled"],Zt={key:1,class:"flex-1 flex flex-col items-center justify-center text-slate-400"},Wt={key:0,class:"hidden xl:flex w-80 bg-slate-900 border-l border-white/10 flex-col backdrop-blur-xl shrink-0 transition-all"},qt={key:0,class:"flex-1 flex items-center justify-center text-slate-400"},Jt={key:1,class:"flex-1 overflow-y-auto p-4 space-y-6"},Yt={class:"p-3 bg-slate-800/50 rounded-lg border border-white/5"},Gt={class:"text-white font-medium"},Qt={class:"text-slate-400 text-sm"},Xt={class:"text-slate-400 text-sm"},es={class:"space-y-4"},ts={class:"space-y-2 max-h-40 overflow-y-auto pr-1"},ss=["checked","onChange"],os={class:"text-white block"},ls={key:0,class:"text-xs text-slate-500"},ns={key:0,class:"text-xs text-slate-500 italic"},as={class:"space-y-2"},rs=["checked","onChange"],is={class:"text-white"},ds={key:0,class:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4"},us={class:"bg-slate-900 border border-white/10 rounded-xl max-w-lg w-full max-h-[90vh] flex flex-col overflow-hidden shadow-2xl"},cs={class:"flex items-center justify-between p-4 border-b border-white/10"},vs={class:"flex items-center gap-3"},ps={class:"text-white font-medium"},fs={class:"flex-1 overflow-y-auto p-4 bg-slate-800/50"},hs={key:0,class:"flex items-center justify-center min-h-[200px]"},ms=["src"],gs={key:1,class:"text-center"},xs={class:"text-white font-medium"},bs={class:"text-slate-400 text-sm"},ws={key:1,class:"flex gap-2 mt-4 justify-center flex-wrap"},ys=["onClick"],ks=["src"],Cs={key:1,class:"w-16 h-16 bg-slate-700 flex items-center justify-center"},_s=["onClick"],Ds={class:"p-4 bg-slate-800 border-t border-white/10"},Ms={class:"flex items-center gap-3"},js=["disabled"],Is={key:1,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"},Ls={class:"bg-slate-900 border border-white/10 rounded-xl max-w-sm w-full shadow-2xl overflow-hidden"},Ts={class:"p-4 bg-indigo-600 flex justify-between items-center"},Bs={class:"p-6 space-y-4"},Us={class:"relative"},zs=["value"],Vs=["disabled"],Es={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},Ns={__name:"Index",props:{initialContacts:Array,catalogs:{type:Object,default:()=>({})}},setup(z){const me=z,ee=Se(),ge=U(()=>ee.props.auth.user),xe=U(()=>ee.props.auth?.user?.tenant||{});i(!1);const j=i(!1),be=()=>{Je.post(route("logout"))},p=i(me.initialContacts),d=i(null),x=i([]),V=i(null),E=i(""),we=i(null),ye=i(null),N=i(!1),ke=i(!0),A=i(!1),v=i({nivel_interes:"",estado_crm:"",notas_crm:"",sedes:[],carreras:[],ofertas:[],eventos:[]}),Ce=async s=>{A.value=!0;try{const e=await h.get(route("chat.contact.details",s));v.value=e.data}catch(e){console.error("Error fetching CRM data",e)}finally{A.value=!1}},_e=async()=>{if(d.value)try{await h.put(route("chat.contact.update",d.value.id),v.value)}catch(s){console.error("Failed to update CRM",s),alert("Error al guardar datos CRM")}},te=(s,e)=>{const o=v.value[s],r=o.indexOf(e);r>-1?o.splice(r,1):o.push(e)},I=i(!1),O=i("591"),y=i(""),$=i(""),L=i([]),T=i(!1);ve(I,s=>{s&&L.value.length===0&&De()});const De=async()=>{try{const s=await h.get("/debug-templates");s.data&&s.data.data&&(L.value=s.data.data.filter(e=>e.status==="APPROVED").map(e=>({name:e.name,language:e.language})),L.value.length>0&&($.value=L.value[0].name))}catch(s){console.error("Error fetching templates",s)}},se=U(()=>p.value.reduce((s,e)=>s+(e.unread||0),0)),oe=async()=>{if(y.value){T.value=!0;try{const s=O.value+y.value,o=(await h.post(route("chat.initiate"),{phone:s,template:$.value})).data,r=p.value.findIndex(b=>b.id===o.id);r===-1?(p.value.unshift({...o,relativeDate:H(o.time,!0),formattedTime:B(o.time)}),S(p.value[0])):S(p.value[r]),I.value=!1,y.value=""}catch(s){console.error("Error initiating chat",s),alert("Error al iniciar chat")}finally{T.value=!1}}},F=i(!1),u=i([]),k=i(""),f=i(0);let R=null;const Me=["Domingo","Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado"],je=["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],B=s=>{if(!s)return"";let e;return s.includes("T")&&(s.includes("+")||s.includes("Z"))?e=new Date(s):e=new Date(s.replace(" ","T")+"Z"),isNaN(e.getTime())?s:e.toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"})},H=(s,e=!1)=>{if(!s)return"";let o;if(s.includes("T")&&(s.includes("+")||s.includes("Z"))?o=new Date(s):o=new Date(s.replace(" ","T")+"Z"),isNaN(o.getTime()))return s;const r=new Date,b=new Date(r.getFullYear(),r.getMonth(),r.getDate()),q=new Date(o.getFullYear(),o.getMonth(),o.getDate()),P=Math.floor((b-q)/(1e3*60*60*24));return P===0?e?B(s):"Hoy":P===1?"Ayer":P===2?"Anteayer":P<7?Me[o.getDay()]:`${o.getDate()} ${je[o.getMonth()]}`},Ie=s=>{if(!s)return"";let e;return s.includes("T")&&(s.includes("+")||s.includes("Z"))?e=new Date(s):e=new Date(s.replace(" ","T")+"Z"),`${e.getFullYear()}-${e.getMonth()}-${e.getDate()}`},le=U(()=>{if(!E.value.trim())return p.value;const s=E.value.toLowerCase();return p.value.filter(e=>e.name&&e.name.toLowerCase().includes(s)||e.lastMessage&&e.lastMessage.toLowerCase().includes(s))}),Le=U(()=>{const s=[];let e=null;return x.value.forEach(o=>{const r=Ie(o.rawDate);r!==e&&(s.push({type:"separator",date:H(o.rawDate),key:"sep-"+r}),e=r),s.push({type:"message",...o})}),s}),Te=async()=>{await qe(),setTimeout(()=>{V.value&&(V.value.scrollTop=V.value.scrollHeight)},100)};ve(x,()=>{Te()},{deep:!0});const S=async s=>{if(d.value=s,x.value=[],ne(),Ce(s.id),s.unread>0)try{await h.post(route("chat.read",s.id));const e=p.value.findIndex(o=>o.id===s.id);e!==-1&&(p.value[e].unread=0)}catch(e){console.error("Error marking as read",e)}},ne=async()=>{if(d.value)try{const e=(await h.get(route("chat.messages",d.value.id))).data.map(o=>({id:o.id,text:o.body,sender:o.direction==="outgoing"?"me":"them",time:B(o.created_at),rawDate:o.created_at,msgType:o.type,metadata:o.metadata?JSON.parse(o.metadata):null}));e.length!==x.value.length&&(x.value=e)}catch(s){console.error("Error loading messages",s)}},Be=async()=>{try{const s=await h.get(route("chat.contacts"));p.value=s.data.map(e=>({...e,relativeDate:H(e.time,!0),formattedTime:B(e.time)}))}catch(s){console.error("Error fetching contacts",s)}},C=i(""),_=i(!1),ae=async()=>{if(!C.value.trim()||!d.value)return;const s=C.value;C.value="",_.value=!0;const e=new Date().toISOString(),o=Date.now();x.value.push({id:o,text:s,sender:"me",time:B(e),rawDate:e});try{await h.post(route("chat.send",d.value.id),{message:s})}catch(r){console.error("Failed to send",r),alert("Error al enviar mensaje")}finally{_.value=!1}},re=s=>{if(!s)return"?";const e=s.split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():s.substring(0,2).toUpperCase()},ie=s=>{if(!s)return"bg-slate-500";const e=["bg-indigo-500","bg-purple-500","bg-pink-500","bg-rose-500","bg-orange-500","bg-teal-500","bg-cyan-500","bg-emerald-500"],o=s.charCodeAt(0)%e.length;return e[o]},Ue=s=>{window.open(s,"_blank")},K=s=>{if(s.metadata?.filename)return s.metadata.filename;if(s.text&&!s.text.includes("/"))return s.text;if(s.text?.includes("/")){const e=s.text.split("/");return e[e.length-1]||"Documento"}return"Documento"},Z=s=>K(s).split(".").pop()?.toUpperCase()||"Archivo",de=s=>s.metadata?.local_url?s.metadata.local_url:s.text?.startsWith("http")?s.text:`/storage/chat-media/${s.text}`,ze=s=>{const e=Z(s).toLowerCase();return{pdf:"bg-red-500",doc:"bg-blue-600",docx:"bg-blue-600",xls:"bg-green-600",xlsx:"bg-green-600",txt:"bg-gray-500"}[e]||"bg-slate-500"},Ve=s=>{const e=Z(s).toUpperCase();return e.length>4?e.substring(0,4):e},Ee=s=>{const e=de(s);window.open(e,"_blank")},Ne=async(s,e="")=>{const o=new FormData;o.append("image",s),e&&o.append("caption",e);const r=Date.now()+Math.random(),b=URL.createObjectURL(s);x.value.push({id:r,text:b,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"image",metadata:e?{caption:e}:null});try{await h.post(route("chat.sendImage",d.value.id),o,{headers:{"Content-Type":"multipart/form-data"}})}catch(q){console.error("Failed to send image",q)}},$e=async s=>{const e=new FormData;e.append("document",s),e.append("filename",s.name);const o=Date.now()+Math.random();x.value.push({id:o,text:s.name,sender:"me",time:new Date().toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"}),rawDate:new Date().toISOString(),msgType:"document"});try{await h.post(route("chat.sendDocument",d.value.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){console.error("Failed to send document",r)}},Fe=s=>{const e=Array.from(s.target.files);!e.length||!d.value||(W(e),s.target.value="")},Pe=s=>{const e=Array.from(s.target.files);!e.length||!d.value||(W(e),s.target.value="")},W=s=>{u.value=s.map(e=>({file:e,name:e.name,type:e.type,isImage:e.type.startsWith("image/"),preview:e.type.startsWith("image/")?URL.createObjectURL(e):null,size:(e.size/1024).toFixed(1)+" KB"})),f.value=0,k.value="",F.value=!0},ue=()=>{u.value.forEach(s=>{s.preview&&URL.revokeObjectURL(s.preview)}),u.value=[],k.value="",F.value=!1},Ae=s=>{u.value[s].preview&&URL.revokeObjectURL(u.value[s].preview),u.value.splice(s,1),u.value.length===0?ue():f.value>=u.value.length&&(f.value=u.value.length-1)},ce=async()=>{if(!u.value.length||!d.value)return;F.value=!1,_.value=!0;const s=k.value;for(const e of u.value)e.isImage?await Ne(e.file,s):await $e(e.file);u.value.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)}),u.value=[],k.value="",_.value=!1},Oe=s=>{s.preventDefault(),N.value=!0},Re=()=>{N.value=!1},He=s=>{if(s.preventDefault(),N.value=!1,!d.value)return;const e=Array.from(s.dataTransfer.files);e.length&&W(e)};return Ke(()=>{R=setInterval(()=>{Be(),d.value&&ne()},5e3)}),Ze(()=>{R&&clearInterval(R)}),(s,e)=>(n(),l(m,null,[J(Y(We),{title:"Chat WhatsApp"}),t("div",Qe,[t("div",Xe,[t("div",et,[t("div",tt,[t("span",st,a(xe.value?.name?.charAt(0)||"C"),1)])]),t("nav",ot,[J(Y(fe),{href:s.route("tenant.dashboard"),class:"flex items-center justify-center p-3 mx-2 rounded-xl text-slate-400 hover:bg-white/10 hover:text-white transition-colors",title:"Dashboard"},{default:pe(()=>[...e[15]||(e[15]=[t("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)])]),_:1},8,["href"]),e[16]||(e[16]=t("div",{class:"flex items-center justify-center p-3 mx-2 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg"},[t("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1))]),t("div",lt,[t("button",{onClick:e[0]||(e[0]=o=>j.value=!j.value),class:"relative w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center mx-auto"},[t("span",nt,a(ge.value?.name?.charAt(0)||"U"),1)]),j.value?(n(),l("div",at,[J(Y(fe),{href:s.route("tenant.settings"),class:"flex items-center gap-2 px-4 py-2.5 text-sm text-slate-300 hover:bg-white/10"},{default:pe(()=>[...e[17]||(e[17]=[G(" ConfiguraciÃ³n",-1)])]),_:1},8,["href"]),t("button",{onClick:be,class:"flex w-full items-center gap-2 px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10"},"Cerrar SesiÃ³n")])):c("",!0)])]),t("div",rt,[t("div",it,[t("div",dt,[t("div",ut,[e[18]||(e[18]=t("h2",{class:"text-white font-semibold text-lg"},"Conversaciones",-1)),se.value>0?(n(),l("span",ct,a(se.value),1)):c("",!0)]),t("button",{onClick:e[1]||(e[1]=o=>I.value=!0),class:"p-2 bg-indigo-500/20 hover:bg-indigo-500/30 rounded-lg text-indigo-400 transition-colors",title:"Nuevo Chat"},[...e[19]||(e[19]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])]),t("div",vt,[e[20]||(e[20]=t("svg",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>E.value=o),type:"text",placeholder:"Buscar chat...",class:"w-full pl-10 pr-4 py-2.5 rounded-xl bg-slate-700/50 border border-white/10 text-white text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},null,512),[[D,E.value]])])]),t("div",pt,[le.value.length===0?(n(),l("div",ft,[...e[21]||(e[21]=[t("svg",{class:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),t("p",{class:"text-sm"},"No hay conversaciones",-1)])])):c("",!0),(n(!0),l(m,null,M(le.value,o=>(n(),l("div",{key:o.id,onClick:r=>S(o),class:w(["flex items-center p-4 cursor-pointer border-b border-white/5 transition-all duration-200 hover:bg-white/5",{"bg-indigo-500/20 border-l-4 border-l-indigo-500":d.value&&d.value.id===o.id}])},[t("div",{class:w([ie(o.name),"w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-sm shadow-md"])},a(re(o.name)),3),t("div",mt,[t("div",gt,[t("h3",xt,a(o.name),1),t("span",bt,a(o.relativeDate||o.formattedTime),1)]),t("p",wt,a(o.lastMessage||"Sin mensajes"),1)]),o.unread>0?(n(),l("div",yt,a(o.unread),1)):c("",!0)],10,ht))),128))])]),t("div",{class:"flex-1 flex flex-col bg-slate-900/50 min-h-0 relative",onDragover:Oe,onDragleave:Re,onDrop:He},[d.value?(n(),l("div",kt,[t("div",Ct,[t("div",_t,[t("div",{class:w([ie(d.value.name),"w-11 h-11 rounded-full flex items-center justify-center text-white font-semibold shadow-md"])},a(re(d.value.name)),3),t("div",Dt,[t("h3",Mt,a(d.value.name),1),e[22]||(e[22]=t("p",{class:"text-xs text-green-400"},"En lÃ­nea",-1))])])]),t("div",{ref_key:"messageContainer",ref:V,class:"flex-1 overflow-y-auto px-6 py-4 min-h-0"},[(n(!0),l(m,null,M(Le.value,o=>(n(),l(m,{key:o.key||o.id},[o.type==="separator"?(n(),l("div",jt,[t("span",It,a(o.date),1)])):(n(),l("div",{key:1,class:w(["flex mb-2",o.sender==="me"?"justify-end":"justify-start"])},[t("div",{class:w(["max-w-[70%] px-3 py-2 rounded-xl shadow-sm relative",o.sender==="me"?"bg-indigo-600 rounded-br-sm":"bg-slate-700 rounded-bl-sm"])},[o.msgType==="image"?(n(),l(m,{key:0},[t("img",{src:o.text,alt:"Imagen",class:"max-w-[280px] max-h-[300px] rounded-lg cursor-pointer hover:opacity-90 object-cover",onClick:r=>Ue(o.text)},null,8,Lt),o.metadata?.caption?(n(),l("p",Tt,a(o.metadata.caption),1)):c("",!0)],64)):o.msgType==="document"?(n(),l(m,{key:1},[t("div",Bt,[t("div",{class:w(["flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center",ze(o)])},[t("span",Ut,a(Ve(o)),1)],2),t("div",zt,[t("p",Vt,a(K(o)),1),t("p",Et,a(Z(o)),1)])]),t("div",Nt,[t("button",{onClick:r=>Ee(o),class:"text-indigo-300 hover:text-indigo-200 font-medium"},"Abrir",8,$t),t("a",{href:de(o),download:K(o),class:"text-indigo-300 hover:text-indigo-200 font-medium"},"Descargar",8,Ft)])],64)):(n(),l("p",Pt,a(o.text),1)),t("div",At,[t("span",Ot,a(o.time),1),o.sender==="me"?(n(),l("svg",Rt,[...e[23]||(e[23]=[t("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"},null,-1)])])):c("",!0)])],2)],2))],64))),128))],512),N.value?(n(),l("div",Ht,[...e[24]||(e[24]=[t("div",{class:"text-center"},[t("svg",{class:"w-16 h-16 mx-auto text-indigo-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),t("p",{class:"text-lg font-semibold text-indigo-300"},"Suelta tus archivos aquÃ­")],-1)])])):c("",!0),t("div",St,[t("input",{type:"file",ref_key:"imageInput",ref:we,accept:"image/*",multiple:"",class:"hidden",onChange:Fe},null,544),t("input",{type:"file",ref_key:"documentInput",ref:ye,multiple:"",class:"hidden",onChange:Pe},null,544),t("button",{onClick:e[3]||(e[3]=o=>s.$refs.imageInput.click()),class:"p-2 rounded-lg hover:bg-white/10 text-slate-400 transition-colors",title:"Enviar imagen"},[...e[25]||(e[25]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]),t("button",{onClick:e[4]||(e[4]=o=>s.$refs.documentInput.click()),class:"p-2 rounded-lg hover:bg-white/10 text-slate-400 transition-colors",title:"Enviar documento"},[...e[26]||(e[26]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])]),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>C.value=o),onKeyup:Q(ae,["enter"]),type:"text",placeholder:"Escribe un mensaje",class:"flex-1 px-5 py-3 rounded-xl bg-slate-700/50 border border-white/10 text-white text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,544),[[D,C.value]]),t("button",{onClick:ae,disabled:_.value||!C.value.trim(),class:"p-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-lg"},[...e[27]||(e[27]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,Kt)])])):(n(),l("div",Zt,[...e[28]||(e[28]=[he('<div class="w-24 h-24 bg-slate-700/50 rounded-full flex items-center justify-center mb-4" data-v-bd770c10><svg class="w-12 h-12 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-bd770c10><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-bd770c10></path></svg></div><h3 class="text-xl font-medium text-white mb-2" data-v-bd770c10>Chat WhatsApp</h3><p class="text-sm" data-v-bd770c10>Selecciona un chat para comenzar</p>',3)])]))],32),d.value&&ke.value?(n(),l("div",Wt,[t("div",{class:"p-4 border-b border-white/10 flex justify-between items-center"},[e[29]||(e[29]=t("h3",{class:"text-white font-semibold"},"CRM Contacto",-1)),t("button",{onClick:_e,class:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium rounded-lg transition-colors"}," Guardar ")]),A.value?(n(),l("div",qt,[...e[30]||(e[30]=[t("svg",{class:"animate-spin h-5 w-5 mr-2 text-white",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),G(" Cargando... ",-1)])])):(n(),l("div",Jt,[t("div",Yt,[e[31]||(e[31]=t("p",{class:"text-xs text-slate-500 uppercase font-bold mb-2"},"Contacto",-1)),t("p",Gt,a(d.value.name),1),t("p",Qt,a(d.value.wa_id),1),t("p",Xt,a(d.value.email||"Sin email"),1)]),t("div",es,[t("div",null,[e[33]||(e[33]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Nivel de InterÃ©s",-1)),g(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>v.value.nivel_interes=o),class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none"},[...e[32]||(e[32]=[t("option",{value:""},"-- Seleccionar --",-1),t("option",{value:"frio"},"â„ï¸ FrÃ­o",-1),t("option",{value:"tibio"},"ðŸ”¥ Tibio",-1),t("option",{value:"caliente"},"ðŸ’¥ Caliente",-1)])],512),[[X,v.value.nivel_interes]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Estado CRM",-1)),g(t("select",{"onUpdate:modelValue":e[7]||(e[7]=o=>v.value.estado_crm=o),class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none"},[...e[34]||(e[34]=[he('<option value="" data-v-bd770c10>-- Seleccionar --</option><option value="prospecto" data-v-bd770c10>Prospecto</option><option value="interesado" data-v-bd770c10>Interesado</option><option value="inscrito" data-v-bd770c10>Inscrito</option><option value="perdido" data-v-bd770c10>Perdido</option>',5)])],512),[[X,v.value.estado_crm]])])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-xs font-medium text-slate-400 mb-2"},"Carreras de InterÃ©s",-1)),t("div",ts,[(n(!0),l(m,null,M(z.catalogs.carreras,o=>(n(),l("label",{key:o.id,class:"flex items-start gap-2 p-2 rounded hover:bg-white/5 cursor-pointer text-sm"},[t("input",{type:"checkbox",checked:v.value.carreras.includes(o.id),onChange:r=>te("carreras",o.id),class:"mt-1 rounded bg-slate-700 border-slate-500 text-indigo-600 focus:ring-indigo-500"},null,40,ss),t("div",null,[t("span",os,a(o.nombre),1),o.duracion?(n(),l("span",ls,a(o.duracion),1)):c("",!0)])]))),128)),z.catalogs.carreras?.length?c("",!0):(n(),l("p",ns,"No hay carreras disponibles"))])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-xs font-medium text-slate-400 mb-2"},"Sedes Preferidas",-1)),t("div",as,[(n(!0),l(m,null,M(z.catalogs.sedes,o=>(n(),l("label",{key:o.id,class:"flex items-center gap-2 p-2 rounded hover:bg-white/5 cursor-pointer text-sm"},[t("input",{type:"checkbox",checked:v.value.sedes.includes(o.id),onChange:r=>te("sedes",o.id),class:"rounded bg-slate-700 border-slate-500 text-indigo-600 focus:ring-indigo-500"},null,40,rs),t("span",is,a(o.nombre),1)]))),128))])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1"},"Notas / Observaciones",-1)),g(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=o=>v.value.notas_crm=o),rows:"4",class:"w-full bg-slate-800 border border-white/10 rounded-lg text-white text-sm px-3 py-2 focus:ring-1 focus:ring-indigo-500 outline-none placeholder-slate-600",placeholder:"Escribe notas aquÃ­..."},null,512),[[D,v.value.notas_crm]])]),e[39]||(e[39]=t("div",{class:"h-10"},null,-1))]))])):c("",!0),j.value?(n(),l("div",{key:1,onClick:e[9]||(e[9]=o=>j.value=!1),class:"fixed inset-0 z-40"})):c("",!0)]),F.value?(n(),l("div",ds,[t("div",us,[t("div",cs,[t("div",vs,[t("button",{onClick:ue,class:"p-2 hover:bg-white/10 rounded-full transition-colors"},[...e[40]||(e[40]=[t("svg",{class:"w-5 h-5 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),t("span",ps,a(u.value.length)+" archivo"+a(u.value.length>1?"s":""),1)])]),t("div",fs,[u.value[f.value]?(n(),l("div",hs,[u.value[f.value].isImage?(n(),l("img",{key:0,src:u.value[f.value].preview,class:"max-w-full max-h-[300px] rounded-lg object-contain"},null,8,ms)):(n(),l("div",gs,[e[41]||(e[41]=t("svg",{class:"w-20 h-20 mx-auto text-slate-500 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t("p",xs,a(u.value[f.value].name),1),t("p",bs,a(u.value[f.value].size),1)]))])):c("",!0),u.value.length>1?(n(),l("div",ws,[(n(!0),l(m,null,M(u.value,(o,r)=>(n(),l("div",{key:r,class:w(["relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all",f.value===r?"border-indigo-500":"border-transparent"]),onClick:b=>f.value=r},[o.isImage?(n(),l("img",{key:0,src:o.preview,class:"w-16 h-16 object-cover"},null,8,ks)):(n(),l("div",Cs,[...e[42]||(e[42]=[t("svg",{class:"w-8 h-8 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])])),t("button",{onClick:Ye(b=>Ae(r),["stop"]),class:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center shadow-lg"},[...e[43]||(e[43]=[t("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,_s)],10,ys))),128))])):c("",!0)]),t("div",Ds,[t("div",Ms,[g(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>k.value=o),type:"text",placeholder:"Agregar un comentario...",class:"flex-1 bg-slate-700/50 text-white px-4 py-3 rounded-xl border border-white/10 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 placeholder-slate-400",onKeyup:Q(ce,["enter"])},null,544),[[D,k.value]]),t("button",{onClick:ce,disabled:_.value,class:"p-3 bg-indigo-500 hover:bg-indigo-600 rounded-xl transition-colors disabled:opacity-50"},[...e[44]||(e[44]=[t("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,js)])])])])):c("",!0),I.value?(n(),l("div",Is,[t("div",Ls,[t("div",Ts,[e[46]||(e[46]=t("h3",{class:"text-white font-semibold text-lg"},"Iniciar ConversaciÃ³n",-1)),t("button",{onClick:e[11]||(e[11]=o=>I.value=!1),class:"text-white/80 hover:text-white transition-colors"},[...e[45]||(e[45]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Bs,[t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Prefijo PaÃ­s",-1)),t("div",Us,[e[47]||(e[47]=t("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium"},"+",-1)),g(t("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>O.value=o),type:"text",class:"w-full pl-6 pr-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none",placeholder:"591"},null,512),[[D,O.value]])])]),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"NÃºmero de TelÃ©fono",-1)),g(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>y.value=o),type:"tel",class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none",placeholder:"70012345",onKeyup:Q(oe,["enter"])},null,544),[[D,y.value]])]),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"},"Plantilla de Inicio (Opcional)",-1)),g(t("select",{"onUpdate:modelValue":e[14]||(e[14]=o=>$.value=o),class:"w-full px-4 py-2 rounded-lg bg-slate-700/50 border border-white/10 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none text-sm"},[e[50]||(e[50]=t("option",{value:""},"-- Ninguna --",-1)),(n(!0),l(m,null,M(L.value,o=>(n(),l("option",{key:o.name,value:o.name},a(o.name)+" ("+a(o.language)+") ",9,zs))),128))],512),[[X,$.value]]),e[52]||(e[52]=t("p",{class:"text-xs text-slate-400 mt-1"},"Si el contacto no te ha escrito en 24h, usa una plantilla. ",-1))]),t("button",{onClick:oe,disabled:T.value||!y.value,class:"w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[T.value?(n(),l("span",Es)):c("",!0),G(" "+a(T.value?"Iniciando...":"Iniciar Chat"),1)],8,Vs)])])])):c("",!0)],64))}},Ps=Ge(Ns,[["__scopeId","data-v-bd770c10"]]);export{Ps as default};
